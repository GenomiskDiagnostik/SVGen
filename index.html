<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SVGen</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --card: #1e293b;
      --accent: #38bdf8;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --border: #334155;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
    }

    .card {
      width: min(1100px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.35);
    }

    h1 {
      margin: 0 0 12px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    p.description {
      margin: 0 0 16px;
      color: var(--muted);
      line-height: 1.5;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .title-logo {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .control {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
    }

    label {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="range"],
    input[type="file"],
    input[type="color"] {
      width: 100%;
      accent-color: var(--accent);
    }

    input[type="color"].swatch {
      width: 48px;
      min-width: 48px;
      height: 36px;
      padding: 0;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 12px 0 18px;
    }

    button {
      background: linear-gradient(135deg, #38bdf8, #06b6d4);
      border: none;
      color: #0b1224;
      font-weight: 700;
      border-radius: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      box-shadow: none;
      border: 1px solid var(--border);
    }

    button:active {
      transform: translateY(1px);
    }

    .status {
      margin: 6px 0 14px;
      color: var(--muted);
      font-size: 14px;
      min-height: 20px;
    }

    .panels {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 16px;
    }

    .panel {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      min-height: 360px;
      position: relative;
    }

    .panel h2 {
      margin-top: 0;
      font-size: 16px;
      color: var(--muted);
    }

    #svgOutput {
      width: 100%;
      min-height: 320px;
      border-radius: 10px;
      border: 1px dashed var(--border);
      background: #0b1224;
      overflow: auto;
      position: relative;
    }

    .hint {
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }

    .inline-flex {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      background: rgba(56, 189, 248, 0.12);
      border: 1px solid rgba(56, 189, 248, 0.3);
      font-size: 12px;
      color: #a5f3fc;
    }

    .hidden {
      display: none;
    }

    .svg-canvas {
      width: 100%;
      height: 100%;
      min-height: 320px;
      display: block;
    }

    .viewport {
      width: 100%;
      min-height: 320px;
      border-radius: 10px;
      border: 1px dashed var(--border);
      background: #0b1224;
      overflow: hidden;
      position: relative;
      cursor: default;
    }

    #previewViewport {
      cursor: grab;
    }

    #previewViewport.dragging {
      cursor: grabbing;
    }

    .viewport-inner {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      transform-origin: center center;
      will-change: transform;
    }

    .viewport canvas,
    .viewport svg {
      max-width: 100%;
      max-height: 100%;
    }

    #svgOutput {
      overflow: hidden;
    }

    input[type="range"].warn-orange {
      accent-color: #fb923c;
    }

    input[type="range"].warn-red {
      accent-color: #f87171;
    }

    .selection-overlay {
      position: absolute;
      top: 0;
      left: 0;
      border: 1px dashed #38bdf8;
      background: rgba(56, 189, 248, 0.15);
      pointer-events: none;
      display: none;
      z-index: 2;
    }
  </style>
  <script src="./vendor/imagetracer_v1.2.6.js"></script>
</head>
<body>
  <main class="card">
    <div class="title-row">

        <svg width="200" height="200" viewBox="0 0 1024 1024" class="svg-canvas" preserveAspectRatio="xMidYMid meet" style="background: transparent;"><path fill="rgb(0,0,0)" stroke="rgb(0,0,0)" stroke-width="0" opacity="0" d="M 0 0 L 1024 0 L 1024 1024 L 0 1024 L 0 0 Z M 328 124 Q 301 127 286 140 Q 266 155 258 182 L 257 184 L 257 186 L 256 191 L 257 515 L 256 522 L 258 521 Q 261 540 272 552 Q 290 576 331 578 L 334 579 L 350 578 L 357 579 L 359 579 L 396 578 L 400 579 L 414 578 L 421 579 L 423 579 L 454 578 L 458 579 L 461 578 L 494 579 L 496 579 L 558 578 L 560 579 L 565 578 L 574 579 L 576 579 L 607 578 L 614 579 L 616 579 L 647 576 Q 664 570 677 559 Q 702 539 701 493 L 706 496 L 706 494 L 718 502 Q 726 503 729 500 L 734 487 L 772 313 Q 771 305 766 302 L 759 302 L 710 313 L 700 312 L 699 188 Q 694 163 679 148 Q 662 128 630 124 L 328 124 Z M 210 639 Q 186 642 173 655 Q 157 668 155 695 Q 156 712 165 722 Q 175 732 190 737 L 227 746 L 240 751 L 248 762 Q 249 772 245 778 Q 239 785 228 787 Q 210 789 201 782 L 192 771 L 192 769 L 189 761 L 189 758 L 150 761 Q 151 785 164 799 Q 179 816 209 820 Q 252 823 272 802 L 275 800 Q 285 790 288 772 Q 290 748 280 737 Q 266 720 243 714 Q 238 715 239 713 L 238 713 L 203 702 Q 196 699 195 691 L 198 681 Q 205 669 225 670 L 225 672 L 227 671 L 239 674 Q 248 679 248 693 L 263 692 L 265 692 L 278 690 L 281 691 L 286 690 Q 284 672 275 662 Q 256 636 210 639 Z M 526 639 Q 497 643 482 659 L 478 661 Q 456 683 453 725 Q 452 771 475 795 Q 493 815 527 820 Q 574 823 597 801 L 610 787 L 610 723 L 609 721 L 607 722 L 592 721 L 590 721 L 583 720 L 567 722 L 562 721 L 560 722 L 554 721 L 547 722 L 544 721 L 541 722 L 541 752 L 542 752 L 543 750 L 568 750 L 569 752 L 569 750 L 572 751 L 574 750 L 575 751 L 573 752 L 575 752 Q 577 766 571 774 Q 563 785 547 787 Q 522 789 511 778 Q 495 765 494 738 Q 492 702 508 685 Q 516 675 531 672 Q 552 670 563 679 Q 572 686 573 700 L 610 696 Q 607 675 595 662 Q 575 636 526 639 Z M 293 640 L 292 645 L 350 816 L 352 817 L 399 817 L 457 644 L 457 641 L 455 642 L 419 641 L 416 644 L 402 691 L 401 690 L 400 690 L 401 693 L 376 776 L 333 644 L 332 642 L 330 642 L 298 642 L 295 640 L 293 640 Z M 680 684 Q 660 687 649 698 Q 629 714 626 748 Q 625 781 640 798 Q 654 816 683 820 Q 714 822 730 808 Q 744 796 750 777 L 715 773 L 712 780 Q 706 787 696 790 Q 682 791 675 786 Q 664 779 662 765 Q 660 759 665 760 L 667 760 L 737 761 L 749 760 Q 751 721 733 702 Q 717 682 680 684 Z M 829 684 Q 815 687 807 694 L 800 702 L 799 702 L 799 686 L 762 686 L 762 817 L 763 817 L 799 817 L 799 737 L 803 724 Q 809 715 823 714 L 834 717 Q 840 721 842 730 L 843 750 L 843 752 L 842 757 L 843 760 L 842 764 L 843 766 L 842 771 L 843 775 L 842 784 L 842 786 L 843 792 L 842 794 L 843 800 L 843 802 L 842 805 L 842 807 L 843 809 L 842 812 L 842 816 L 844 817 L 870 817 L 872 817 Q 878 819 880 816 L 880 730 Q 879 710 869 699 Q 858 682 829 684 Z M 761 774 L 760 789 L 761 789 L 761 774 Z "/><path fill="rgb(0,0,0)" stroke="rgb(0,0,0)" stroke-width="0" opacity="0" d="M 686.5 712 Q 701.6 711.4 708 719.5 Q 713.3 726 714 736 L 663 735.5 Q 665.3 722.3 674.5 716 L 686.5 712 Z "/><path fill="rgb(226,143,117)" stroke="rgb(226,143,117)" stroke-width="0" opacity="0.996078431372549" d="M 327.5 151 L 575.5 151 L 632.5 152 L 635 153.5 L 633.5 154 L 506.5 153 L 506.5 154 L 529.5 155 L 532 154 L 531.5 156 L 529.5 156 L 528 156.5 L 530 157.5 L 527.5 159 L 523.5 158 L 522.5 160 L 524.5 159 L 528 160.5 L 526 161.5 L 527 163.5 L 526 163.5 L 525.5 162 L 523 165.5 L 523.5 167 L 521 167.5 L 522.5 172 L 520.5 171 L 519 176 L 514 176.5 L 515 180.5 L 514 180.5 L 513.5 177 L 511 182.5 L 513 183.5 L 509 184.5 Q 512.8 186.3 509.5 188 L 508 187.5 L 507.5 189 L 506.5 186 L 504 191.5 L 504.5 193 L 502 194.5 L 501 196.5 L 503 197.5 L 499 198 L 498.5 200 L 496 199 L 497 202.5 L 494.5 203 L 493 205 L 495 205.5 L 491 206.5 L 493 207.5 L 489.5 210 L 488 209.5 L 487 211.5 L 488 214.5 L 487 214.5 L 486.5 213 L 486 215 L 482.5 214 L 482 216 L 484 216.5 L 481 218.5 L 480.5 220 L 479.5 218 L 477 221.5 L 479 222.5 L 475 225.5 L 474.5 223 L 471 228.5 L 472 230.5 L 471 230.5 L 470.5 229 L 470 231 L 467.5 230 L 467 231.5 L 466.5 234 L 463.5 233 L 463.5 234 L 465 234.5 L 463.5 238 L 462 237.5 L 461.5 239 Q 459.7 236.3 458 240.5 L 460 241.5 L 458.5 242 L 457 241.5 L 455.5 245 L 451.5 244 L 451.5 245 Q 454.5 244.1 453 248.5 L 450 248.5 L 449.5 246 L 445.5 256 L 443.5 257 L 442 256.5 Q 441.9 280.9 428.5 292 L 430 289.5 Q 441.8 278.3 440 253.5 Q 436.3 237.2 425.5 228 Q 414.3 215.7 389.5 217 Q 370.5 221 361 234.5 Q 353 244.5 352 261.5 Q 353.8 282.5 365 293 Q 376.5 305.2 401.5 305 L 415.5 300 L 416 302 Q 406.1 307.9 387.5 306 L 383.5 305 L 383.5 306 L 386 306.5 L 377 309 L 374.5 314 L 371 315.5 L 371.5 317 L 368 318 Q 369.3 321 365.5 320 L 365.5 322 L 363 323.5 L 362.5 325 L 360.5 325 L 358 325.5 L 358.5 327 L 356 326 L 357 328.5 L 354 330 L 354 332 Q 348.2 329.8 349 333.5 L 348.5 336 L 346.5 336 L 344 336 L 342 339.5 L 341 341.5 L 341.5 343 L 339 341.5 L 338 343.5 L 338.5 345 L 336 344.5 L 335.5 342 L 335 344.5 Q 335.9 347.5 331.5 346 L 331.5 348 L 330 347.5 L 329.5 349 L 327.5 349 L 326 349.5 L 326.5 351 L 324 350 L 323.5 355 L 321.5 354 L 319 354.5 L 320 356.5 L 317.5 355 L 315 356.5 L 315.5 358 L 309 357 L 309.5 360 L 310.5 358 L 311 361 L 308.5 362 L 307 361.5 L 306.5 363 L 306 360 L 304 360.5 L 304.5 362 L 302 362.5 L 302.5 364 L 296 363.5 Q 297 359.8 294 361 L 293.5 363 L 293 361 L 289 362.5 L 290.5 365 L 288 364.5 L 288.5 363 L 286.5 364 L 284.5 360 L 284 457.5 L 284.5 459 L 283 457.5 L 283 191.5 Q 287.1 173.1 299.5 163 Q 310.1 153.6 327.5 151 Z "/><path fill="rgb(226,143,117)" stroke="rgb(226,143,117)" stroke-width="0" opacity="0.996078431372549" d="M 395.5 239 Q 407.5 240 413 247.5 Q 418.8 253.2 417 266.5 L 408.5 279 L 394.5 283 Q 382.9 281.1 378 272.5 Q 373.9 267.1 375 256.5 L 382.5 244 L 395.5 239 Z "/><path fill="rgb(226,143,117)" stroke="rgb(226,143,117)" stroke-width="0" opacity="0.996078431372549" d="M 388.5 346 L 398 350.5 L 396.5 350 L 388.5 346 Z "/><path fill="rgb(171,110,160)" stroke="rgb(171,110,160)" stroke-width="0" opacity="0.996078431372549" d="M 576.5 151 L 627 151.5 L 576.5 152 L 576.5 151 Z "/><path fill="rgb(171,110,160)" stroke="rgb(171,110,160)" stroke-width="0" opacity="0.996078431372549" d="M 633.5 152 L 633.5 154 L 637.5 153 L 638 155 L 640.5 154 L 641 156 L 643.5 155 L 643.5 157 L 645.5 156 L 646.5 158 L 648 157.5 L 648.5 159 L 650 158.5 L 649.5 160 L 651.5 161 L 653 160.5 L 654.5 163 L 657 163.5 L 661.5 169 L 664 170.5 L 664.5 173 L 666 173.5 L 666.5 176 L 668 176.5 L 667.5 178 L 669 178.5 L 668 181 L 670 181.5 L 668 182.5 L 671 183.5 L 668.5 185 L 665 184 L 663.5 191 L 661.5 190 L 662 191.5 L 660.5 193 L 661 194.5 Q 661.8 200.3 657.5 201 L 656 201.5 L 656 203.5 Q 657.9 208.9 654.5 208 L 648 211.5 L 650 212.5 L 648 213 L 646.5 216 L 643.5 217 L 642 218.5 L 642.5 220 L 640 219 L 639.5 222 L 637 222.5 L 636.5 225 L 635 227.5 L 632 229 L 630.5 233 L 630 231 L 628 232.5 L 627 234.5 L 627.5 236 L 624 237 L 622 242.5 L 622.5 244 L 619.5 241 L 619 243.5 L 616.5 245 L 616.5 246 L 618 247.5 L 616.5 247 L 615 247.5 L 615.5 249 L 613 250.5 L 614 253.5 L 610.5 258 L 610 256.5 L 610.5 255 L 609 256.5 L 606.5 261 Q 602.8 259.8 604 263.5 L 602 264.5 L 601.5 263 L 601 266.5 L 601.5 268 L 599 267.5 L 598.5 264 L 596.5 269 L 595 269.5 L 595.5 271 L 593 271.5 L 590.5 276 L 588 276.5 L 588.5 278 L 587 278.5 L 587.5 280 L 584 278 L 583.5 276 L 582 276.5 L 582 274.5 L 580.5 272 L 576 270 L 575.5 267 L 573 266.5 L 571.5 264 L 568.5 263 L 567 263.5 L 566.5 262 L 559 262 L 558.5 264 L 556.5 263 L 549 269.5 L 548.5 272 L 546 272.5 L 544 275.5 L 543.5 278 L 542 277.5 L 538 282.5 L 537.5 285 L 536 284.5 L 532 289.5 L 531.5 292 L 530 291.5 L 526 296.5 L 525.5 299 L 524 298.5 L 521 302.5 Q 523.8 304.2 519.5 306 L 515 309.5 Q 517.8 311.3 513.5 313 L 509 316.5 Q 511.7 318.3 507.5 320 L 503 323.5 L 502.5 326 L 501 325.5 L 497 330.5 L 496.5 333 L 495 332.5 L 492 336.5 Q 494.8 338.2 490.5 340 L 485 344.5 L 484.5 347 L 480 350.5 Q 482.7 352.3 478.5 354 L 474 357.5 L 473.5 360 L 472 359.5 L 468 364.5 L 467.5 367 L 462 371.5 Q 464.8 373.3 460.5 375 L 456 378.5 Q 458.8 380.3 454.5 382 L 448 387.5 L 448.5 389 L 442 394.5 L 442.5 396 L 440 397.5 L 437 395.5 L 436.5 394 L 435 394.5 L 435 392.5 L 433.5 391 L 430 388.5 L 429.5 386 L 428 386.5 L 429 385.5 L 425 381.5 L 424.5 380 L 422 379.5 L 423 378.5 L 418.5 374 L 414 370.5 L 415 369.5 L 411 365.5 L 410.5 364 Q 408.7 366.7 407 362.5 Q 410 360.5 405 358.5 L 404.5 357 Q 402.8 359.8 401 355.5 L 402 354.5 L 397.5 350 L 396 350.5 L 396.5 349 L 394.5 348 L 393 348.5 L 393.5 347 L 389.5 348 L 389.5 347 L 391 346.5 L 384.5 346 L 378 349.5 L 378.5 351 Q 376.8 348.3 375 352.5 Q 377.7 354.3 373.5 356 L 371 356.5 L 369 359.5 Q 371.8 361.3 367.5 363 Q 365.8 360.2 364 364.5 L 362 367.5 L 361.5 370 Q 359.7 367.3 358 371.5 L 356 374.5 L 355.5 377 Q 353.8 374.3 352 378.5 L 350 381.5 L 349.5 384 Q 347.7 381.2 346 385.5 L 344 388.5 L 343.5 391 Q 341.8 388.3 340 392.5 L 337 396.5 Q 339.7 398.2 335.5 400 L 333 400.5 L 331 403.5 L 330.5 406 Q 328.8 403.3 327 407.5 L 325 410.5 L 324.5 413 L 322 413.5 L 319 417.5 Q 321.8 419.3 317.5 421 L 315 421.5 L 312 425.5 L 311.5 428 L 309 428.5 L 306 432.5 L 305.5 435 L 303 435.5 L 300 439.5 L 299.5 442 L 297 442.5 L 294 446.5 L 293.5 449 L 292 448.5 L 288 453.5 L 287.5 456 L 286 455.5 L 284.5 458 L 284 360.5 L 285 360.5 L 285.5 363 L 287.5 363 L 289 362.5 L 288.5 361 L 290.5 362 L 293 361 L 293.5 363 L 294 361 Q 297 359.8 296 363.5 Q 298.5 367.5 301 361.5 L 301.5 360 L 302.5 362 L 306 359.5 L 304 358.5 L 305.5 358 L 308.5 360 L 309 357 L 313.5 356 L 313.5 358 L 316 357.5 L 316.5 355 L 318.5 356 L 319.5 354 L 321.5 354 L 323.5 355 L 324 350 L 328.5 348 L 330 348.5 L 331.5 346 Q 335.9 347.5 335 344.5 L 335.5 342 L 336.5 345 L 337 342.5 L 337.5 341 L 338.5 343 L 339.5 341 L 341 341.5 L 342 338 L 346.5 336 L 349 332 L 354 332 L 355.5 330 L 356 327.5 L 357.5 326 L 361.5 324 L 363 324.5 L 364 322.5 L 363.5 321 L 365.5 322 L 365.5 320 L 369.5 318 L 369.5 316 L 371.5 317 L 371.5 313 L 374.5 314 L 377 309 L 386 306.5 L 381 304.5 L 382.5 304 Q 389.7 308.3 403.5 306 L 411 303.5 L 410.5 302 L 413.5 303 L 421 298.5 L 420.5 297 L 422.5 298 L 429.5 289 Q 431.3 291.7 433 287.5 L 432 285.5 L 435 284.5 L 436 281.5 L 435.5 280 L 437 280.5 Q 442.3 270.8 442.5 256 L 444.5 256 L 447 254.5 L 449.5 246 L 453 248.5 Q 454.5 244.1 451.5 245 L 451.5 244 L 455.5 245 L 458 240.5 L 456 239.5 L 456.5 237 L 459.5 239 L 462 238.5 L 465 234.5 L 463 233.5 L 467 231.5 L 467.5 230 L 470 231 L 475 222.5 L 474.5 221 Q 476.7 226.3 479 222.5 L 477 221.5 L 480.5 217 L 482.5 217 L 484 216.5 L 482 216 L 482.5 214 L 486 215 L 486.5 213 L 487.5 215 L 488 212.5 L 488 210.5 L 487 208.5 Q 489 211.7 491 208.5 L 491.5 206 L 495 205.5 L 493 205 L 495 201.5 L 496 199 L 498.5 200 L 499 198 L 503 197.5 L 501 196.5 L 503 193.5 L 502 191.5 L 503 191.5 L 504.5 193 L 504 191.5 L 505 189.5 L 504 187.5 L 505 187.5 L 505.5 189 L 506.5 186 L 507.5 189 L 510 185.5 L 509.5 184 L 513 183.5 L 511 182.5 L 514.5 176 Q 519.9 177.9 519 174.5 L 520 171.5 L 519.5 170 L 522.5 172 L 520 168.5 L 521.5 167 L 524 166.5 L 522 163.5 L 526.5 161 L 528 160.5 L 524.5 159 L 522.5 160 L 523.5 158 L 527 157.5 L 526.5 156 L 528.5 156 L 530 155.5 L 528.5 154 L 506 153.5 L 633.5 152 Z "/><path fill="rgb(171,110,160)" stroke="rgb(171,110,160)" stroke-width="0" opacity="0.996078431372549" d="M 386.5 378 L 393 381.5 Q 390.2 383.3 394.5 385 L 399 388.5 L 398 389.5 L 402.5 394 L 405 395.5 L 405 397.5 L 406.5 400 L 410 401.5 L 408.5 402 Q 405.6 398.4 397.5 400 L 395 401.5 L 395.5 403 L 393 401.5 L 392.5 403 L 392 401.5 L 392.5 400 L 391 401.5 L 386 404 L 387 406.5 L 383.5 408 L 378.5 410 L 376 411 L 374.5 415 L 372 413.5 L 370.5 417 L 368 418.5 L 368.5 420 L 365.5 419 L 366.5 422 L 364.5 421 L 363 421.5 L 363.5 420 L 358 425.5 L 358.5 427 L 356 425.5 L 355.5 427 L 353 427.5 L 351.5 430 L 348.5 429 L 349.5 431 L 352 432.5 L 350.5 432 L 345 433 L 343.5 436 L 339 438.5 L 339.5 440 Q 337.8 437.3 336 441.5 L 335 443.5 L 335.5 445 L 333.5 444 L 331 445.5 L 332.5 448 L 328.5 450 L 327 447.5 L 333 442.5 Q 330.3 440.8 334.5 439 L 336 439.5 L 339 435.5 Q 336.3 433.7 340.5 432 L 345 428.5 L 345.5 426 L 351 421.5 L 351.5 419 L 357 414.5 L 357.5 412 L 362 408.5 Q 359.3 406.8 363.5 405 L 368 401.5 Q 365.3 399.7 369.5 398 L 375 393.5 Q 372.2 391.8 376.5 390 L 380 387.5 Q 377.3 385.7 381.5 384 L 386 380.5 L 386.5 378 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 672.5 194 L 673 323 L 671 322.5 L 672.5 194 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 577.5 270 L 632.5 334 L 635 334.5 L 631 335 L 577.5 270 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 563.5 292 L 606 342.5 L 603 340.5 L 563.5 294 L 561 295.5 L 458 418.5 L 498 464.5 Q 501.3 468.2 500 476.5 L 494.5 484 L 483.5 486 L 474 478.5 L 409 402.5 L 415 407.5 L 479.5 483 L 489.5 485 L 498 478.5 L 499 468.5 L 456 417.5 L 563.5 292 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 654.5 327 L 657 327.5 L 645.5 331 L 645.5 330 L 654.5 327 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 573.5 367 L 581 377.5 L 614 411.5 L 611 416 L 609 415.5 L 613 411.5 L 605 403.5 L 574 370.5 L 573.5 367 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 419.5 375 L 431 387.5 L 424 381.5 L 419.5 375 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 431.5 389 L 439.5 398 L 442 396.5 Q 439 402 436 395.5 L 431.5 389 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 607.5 417 L 609 417.5 Q 567.6 462.1 519.5 500 Q 485.6 526.6 444.5 546 L 433.5 551 L 321.5 551 Q 303.6 547.4 294 535.5 L 286 520.5 L 287 520.5 Q 290.8 532.8 299.5 540 Q 308.3 547.2 321.5 550 L 432.5 550 Q 479.3 530.3 516.5 501 Q 560.2 467.2 598 427.5 L 599.5 425 L 603 422.5 L 607.5 417 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 340.5 433 L 336 438.5 L 329.5 446 L 335 439.5 L 340.5 433 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 322.5 454 L 317 460.5 L 310.5 468 L 316 461.5 L 322.5 454 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 671.5 468 L 673 468.5 L 673 512.5 Q 669.7 530.2 658.5 540 Q 650 548.5 635.5 551 L 549.5 551 L 549.5 550 Q 619.7 518.2 671.5 468 Z M 671 470 Q 621 518 555 549 L 555 550 L 635 550 Q 647 548 656 541 Q 668 531 672 512 L 672 471 L 671 470 Z "/><path fill="rgb(112,182,250)" stroke="rgb(112,182,250)" stroke-width="0" opacity="0.996078431372549" d="M 284.5 498 L 284 499.5 L 283.5 510 L 283 499.5 L 284.5 498 Z "/><path fill="rgb(98,116,187)" stroke="rgb(98,116,187)" stroke-width="0" opacity="0.996078431372549" d="M 665 184 L 668.5 185 L 670 184.5 L 672 193.5 L 672 321.5 L 671.5 324 L 668 323 L 667.5 325 L 665 324 L 664.5 326 L 661.5 325 L 661.5 327 L 658 326 L 657.5 328 L 654.5 327 L 654.5 329 L 651.5 328 L 651.5 330 L 648.5 329 L 648.5 331 L 645.5 330 L 645.5 332 L 642.5 331 L 642.5 333 L 639 332 L 638.5 334 L 636 333 L 635.5 335 L 631.5 333 L 629 332.5 L 628 329.5 L 626.5 327 L 624 326.5 L 623 323.5 L 621.5 321 L 619 320.5 L 618 317.5 L 615.5 314 L 613 313.5 L 612 310.5 L 610.5 308 L 608 307.5 L 607 304.5 L 606.5 303 L 604 302.5 Q 607 300.5 602 298.5 L 600.5 296 Q 598.7 298.8 597 294.5 L 596 291.5 L 595.5 290 Q 593.8 292.8 592 288.5 Q 595 286.5 590 284.5 L 588.5 282 L 586 281.5 L 586.5 277 L 588.5 278 L 588.5 276 L 592 274.5 L 591 272.5 L 592 272.5 L 592.5 274 L 595 269.5 L 593 268.5 L 596.5 266 L 595.5 269 L 598 267.5 L 598.5 264 L 599.5 268 L 601 263.5 L 600.5 262 L 602.5 265 L 604 261.5 L 603.5 260 L 606.5 261 L 609 255.5 L 608.5 254 L 611 255 L 612.5 252 L 613.5 254 L 614 251.5 L 613 249 L 616 248.5 L 615.5 247 L 617.5 248 L 618 246 L 616 245.5 L 619 245 L 620 242.5 L 619.5 241 L 622.5 244 L 622 242.5 L 624 237 L 626 236.5 L 625 234.5 L 626 234.5 L 627.5 236 L 627 234.5 L 628 231 L 630 232.5 L 631 232.5 L 632 229 L 635 227.5 L 636.5 225 L 638.5 221 L 640 221.5 L 639 218.5 L 640.5 219 L 643.5 217 L 646.5 216 L 648 213 L 646 212.5 L 656 208 L 657 202.5 L 656.5 201 L 658 200.5 L 656 197.5 L 658 197.5 L 657 195.5 L 659 196.5 L 659.5 199 L 661 194.5 L 660.5 193 L 662 191.5 L 660 191.5 L 662.5 190 L 664 190.5 L 665 184 Z "/><path fill="rgb(98,116,187)" stroke="rgb(98,116,187)" stroke-width="0" opacity="0.996078431372549" d="M 562 294 L 564.5 295 L 567 295.5 L 566 296.5 L 571 301.5 L 571.5 303 L 574 303.5 Q 571 305.5 576 307.5 L 576.5 309 Q 578.3 306.3 580 310.5 L 581 313.5 L 582.5 316 L 585 316.5 Q 582 318.5 587 320.5 L 587.5 322 L 590 322.5 Q 587 324.5 592 326.5 L 593.5 329 L 596 329.5 L 597 332.5 L 599.5 336 L 602 336.5 L 603 339.5 L 604.5 342 L 607 342.5 L 606.5 344 L 605.5 342 L 605 344 L 601 343 L 600.5 345 L 598 344 L 597.5 346 L 595 345 L 594.5 347 L 592 346 L 591.5 348 L 588.5 347 L 588.5 349 L 586 348 L 585.5 350 L 582.5 349 L 582.5 351 L 580.5 350 L 580.5 352 L 579 351.5 L 576.5 355 L 575 354.5 L 574 356.5 L 575 358.5 L 573 358.5 L 574 366.5 L 573 368.5 L 575 368.5 L 574 370.5 L 576 370.5 L 575 371.5 L 580 376.5 L 580.5 378 L 581.5 377 L 593 388.5 L 592 389.5 L 605 402.5 L 607.5 406 L 608.5 405 L 615 411.5 L 609 415.5 L 609.5 417 L 603 421.5 L 600.5 425 L 598 426.5 L 592 433.5 L 592.5 435 L 591.5 434 L 574.5 451 L 566 458.5 L 567 459.5 L 562.5 464 L 559.5 465 L 556 467.5 Q 559.3 469.7 553.5 472 Q 551.5 469 549.5 474 L 545 477.5 L 544.5 480 L 541.5 481 L 539 482.5 L 538.5 485 L 535.5 486 L 533 487.5 L 532.5 490 L 530.5 490 L 528 491.5 L 527.5 494 L 524.5 495 L 523 495.5 L 522.5 498 L 520.5 498 L 518 499.5 L 518.5 501 L 516.5 501 L 515 501.5 L 514.5 504 L 512.5 503 L 511.5 506 L 509.5 506 L 507 507.5 L 507.5 509 L 505.5 508 L 504.5 511 L 502.5 510 L 501.5 513 L 499.5 513 L 498 513.5 L 497.5 516 L 495.5 515 L 494.5 518 L 492.5 517 L 491.5 520 L 489.5 519 L 488.5 522 L 486.5 521 L 485.5 524 L 483.5 523 L 480 525.5 L 480.5 527 L 478.5 526 L 478.5 528 L 476.5 528 L 475 528.5 L 475.5 530 L 473.5 529 L 473.5 531 L 471.5 531 L 470 531.5 L 470.5 533 L 468.5 532 L 468.5 534 L 466.5 533 L 461 536.5 L 461.5 538 L 459.5 537 L 459.5 539 L 457.5 538 L 457.5 540 L 455.5 539 L 455.5 541 L 453.5 540 L 453.5 542 L 451.5 541 L 451.5 543 L 449.5 542 L 449.5 544 L 447.5 543 L 447.5 545 L 444.5 544 L 442 545.5 L 442.5 547 L 440.5 546 L 440.5 548 L 438.5 547 L 432.5 550 L 319.5 551 L 319.5 550 L 321 549.5 L 317.5 549 L 316 549.5 L 316.5 548 L 313.5 549 L 313.5 547 L 310.5 548 L 310.5 546 L 308.5 547 L 308.5 545 L 306.5 546 L 306.5 544 L 302.5 542 L 300 541.5 L 300.5 540 L 295 535.5 L 294.5 534 L 292 533.5 L 292 531.5 L 291.5 530 L 290 530.5 L 291 528.5 L 288.5 524 L 287 524.5 L 288 522.5 L 286 522.5 L 287 519.5 L 285.5 516 L 284 516.5 L 285 510.5 L 283 498.5 L 288 495.5 L 290 492.5 L 289.5 491 L 290.5 492 L 295 487.5 L 296 485.5 L 296.5 483 L 298.5 483 L 300 481.5 L 301 479.5 L 301.5 477 L 302.5 478 L 307 473.5 L 308 471.5 L 307.5 470 L 310.5 469 L 312 467.5 L 314 464.5 L 314.5 462 L 314.5 464 L 316 462.5 L 319 461 L 321 456.5 L 321.5 454 Q 323.8 457.3 326 451.5 L 327 449.5 L 326.5 448 Q 328.3 451.8 330 448.5 L 329.5 447 L 332.5 448 L 331.5 445 L 333.5 444 L 335.5 445 L 336 442.5 L 339.5 438 L 341 437.5 L 341.5 435 L 341.5 437 L 345 436 Q 343.3 431.5 348.5 433 L 350.5 432 L 352 432.5 L 349.5 431 L 348.5 429 L 351.5 430 L 354 426.5 L 352 425.5 L 353.5 425 L 356 426.5 L 356.5 425 L 358 425.5 L 363.5 420 L 366.5 422 L 365.5 419 L 371 416.5 L 370 414.5 L 371 414.5 L 371.5 416 L 372.5 413 L 375 414.5 L 376 411 L 381 410 Q 379.8 407 383.5 408 L 386 404 L 390 402.5 L 388 401.5 L 389.5 401 L 391 401.5 L 392.5 400 L 395.5 401 L 397 400.5 L 396.5 399 L 405.5 400 L 405.5 398 L 406.5 401 L 409.5 403 L 412 403.5 L 413 406.5 L 415.5 410 L 418 410.5 Q 415 412.5 420 414.5 L 421.5 417 L 424 417.5 L 423 418.5 L 427 422.5 L 428.5 425 L 431 425.5 L 432 428.5 L 434.5 432 L 437 432.5 L 438 435.5 L 440.5 439 L 443 439.5 L 444 442.5 L 446.5 446 L 449 446.5 L 450 449.5 L 453.5 454 L 456 454.5 L 457 457.5 L 459.5 461 L 462 461.5 L 463 464.5 L 465.5 468 L 468 468.5 L 468 470.5 L 470.5 474 L 473 474.5 L 474 477.5 L 476.5 481 Q 478.3 478.3 480 482.5 L 479.5 484 L 482.5 485 L 484 484.5 L 483.5 486 L 490 485.5 L 489.5 484 L 492.5 485 L 492.5 483 L 494.5 484 L 498 479.5 L 497.5 478 L 499 478.5 L 498 475.5 L 499 475.5 L 499.5 477 L 500 468.5 L 498 468.5 L 499 466.5 L 497.5 464 L 495 463.5 L 494 460.5 L 489.5 455 L 487 454.5 L 486 451.5 L 483.5 448 L 481 447.5 L 481 445.5 L 477.5 441 L 475 440.5 Q 478 438.5 473 436.5 L 470.5 433 L 468 432.5 L 467 429.5 L 464.5 426 L 462 425.5 Q 465 423.5 460 421.5 L 458 417.5 L 463 411.5 L 463.5 409 L 466 408.5 L 469 404.5 L 469.5 402 Q 471.2 404.8 473 400.5 L 475 397.5 L 475.5 395 L 477 395.5 L 480 391.5 L 480.5 389 L 483 388.5 L 486 384.5 L 486.5 382 L 489 381.5 L 491 378.5 Q 488.2 376.8 492.5 375 L 494 375.5 L 497 371.5 L 497.5 369 L 500 368.5 L 502 365.5 L 502.5 363 L 505 362.5 L 508 358.5 L 508.5 356 L 511 355.5 L 513 352.5 Q 510.3 350.7 514.5 349 L 517 348.5 L 520 344.5 L 520.5 342 L 522 342.5 L 524 339.5 Q 521.3 337.8 525.5 336 L 528 335.5 L 530 332.5 Q 527.2 330.8 531.5 329 L 533 329.5 L 536 325.5 L 536.5 323 L 539 322.5 L 541 319.5 L 541.5 317 L 544 316.5 L 547 312.5 L 547.5 310 L 549 310.5 L 553 305.5 L 553.5 303 L 556 302.5 L 558 299.5 L 558.5 297 Q 560.2 299.8 562 295.5 L 562 294 Z "/><path fill="rgb(98,116,187)" stroke="rgb(98,116,187)" stroke-width="0" opacity="0.996078431372549" d="M 670.5 470 L 672 470.5 L 672 511.5 L 665 530.5 L 665.5 532 L 663 532.5 L 664 534.5 L 657 539.5 L 656.5 542 L 654.5 541 L 653.5 544 L 651.5 543 L 650.5 546 L 648.5 545 L 648.5 547 L 646.5 546 L 646.5 548 L 643.5 547 L 634.5 550 L 554.5 550 L 553.5 548 L 555.5 549 L 555.5 547 L 557.5 548 L 557.5 546 L 559.5 547 L 559.5 545 L 561.5 546 L 561.5 544 L 563.5 545 L 563.5 543 L 565.5 544 L 565.5 542 L 567.5 543 L 567.5 541 L 569.5 542 L 569.5 540 L 571.5 541 L 571.5 539 L 573.5 540 L 573.5 538 L 575.5 539 L 575.5 537 L 577.5 538 L 581 535.5 L 580.5 534 L 582.5 535 L 582.5 533 L 584.5 534 L 584.5 532 L 586.5 533 L 587.5 530 L 589.5 531 L 589.5 529 L 591.5 530 L 592.5 527 L 594.5 528 L 598 525.5 L 597.5 524 L 599.5 525 L 600.5 522 L 602.5 523 L 603.5 520 L 605.5 521 L 605.5 519 L 607.5 519 L 609 518.5 L 608.5 517 L 610.5 517 L 612 516.5 L 611.5 515 L 613.5 515 L 618 512.5 L 618.5 510 L 620.5 511 L 621.5 508 L 623.5 509 L 625.5 505 L 627.5 506 L 628.5 503 L 630.5 503 L 633 501.5 L 632.5 500 L 634.5 501 L 636.5 497 L 638.5 498 L 640.5 494 L 642.5 495 L 645.5 490 L 647.5 491 L 650.5 486 L 652.5 486 L 657 482.5 L 657.5 480 L 659.5 480 L 665 475.5 Q 662.3 473.7 666.5 472 Q 668.5 475 670.5 470 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 256.5 194 L 257 508.5 L 256 508.5 L 256.5 194 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 282.5 197 L 283 459.5 L 282 459.5 L 282.5 197 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 673.5 224 L 674 247.5 L 673 247.5 L 673.5 224 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 673.5 252 L 674 279.5 L 673 279.5 L 673.5 252 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 673.5 291 L 674 303.5 L 673 303.5 L 673.5 291 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 757.5 303 L 761 303.5 L 753.5 306 L 751.5 305 L 751.5 307 L 749 305.5 L 757.5 303 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 746.5 305 L 748 306.5 L 748.5 308 L 745.5 307 L 745.5 309 L 743 308 Q 744.3 311 740.5 310 L 735.5 312 L 734 311.5 L 731.5 313 L 587 360.5 L 586 365.5 L 629 411.5 L 572.5 469 L 516.5 515 L 471.5 543 L 448.5 552 L 436 549.5 L 437.5 550 L 442 548.5 L 441.5 547 L 443.5 548 L 443.5 546 L 445.5 547 L 445.5 545 L 448.5 546 L 453 543.5 L 452.5 542 L 454.5 543 L 457 541.5 L 456.5 540 L 458.5 541 L 464 537.5 L 463.5 536 L 465.5 537 L 465.5 535 L 467.5 536 L 467.5 534 L 469.5 535 L 469.5 533 L 471.5 534 L 472.5 531 L 474.5 532 L 474.5 530 L 476.5 531 L 477.5 528 L 479.5 529 L 479.5 527 L 481.5 528 L 482.5 525 L 484.5 526 L 484.5 524 L 486.5 524 L 488 523.5 L 487.5 522 L 489.5 522 L 491 521.5 L 490.5 520 L 492.5 520 L 494 519.5 L 493.5 518 L 495.5 518 L 497 517.5 L 496.5 516 L 498.5 516 L 501 514.5 L 500.5 513 L 502.5 514 L 503.5 511 L 505.5 511 L 507 510.5 L 506.5 509 L 508.5 509 L 511 507.5 L 510.5 506 L 512.5 506 L 514 505.5 L 513.5 504 L 515.5 504 L 518 502.5 L 517.5 501 L 519.5 501 L 521 500.5 L 521.5 498 L 523.5 498 L 526 496.5 L 526.5 494 L 528.5 494 L 531 492.5 L 531.5 490 L 533.5 490 L 537 487.5 L 537.5 485 L 539.5 485 L 543 482.5 L 543.5 480 L 545.5 480 L 550 476.5 Q 546.8 474.2 552.5 472 Q 554.5 475 556.5 470 L 560 467.5 Q 557.3 465.7 561.5 464 L 562.5 465 L 567.5 460 L 574 454.5 L 573 453.5 L 591.5 435 L 594 434.5 L 593 433.5 L 605.5 421 Q 607.2 423.7 609 419.5 L 608.5 418 L 609.5 419 L 615 413.5 L 616 411.5 L 614 410.5 L 614.5 409 L 611 406.5 L 607.5 402 L 606.5 403 L 593 389.5 L 594 388.5 L 588 382.5 L 586.5 380 L 585 378.5 L 576 371.5 L 577 369.5 L 575.5 367 L 574 367.5 L 575 360.5 L 574.5 359 L 576 359.5 L 575 356.5 L 580 353.5 L 579.5 352 L 581.5 353 L 581.5 351 L 583.5 352 L 583.5 350 L 586.5 351 L 586.5 349 L 589.5 350 L 589.5 348 L 592.5 349 L 592.5 347 L 595.5 348 L 595.5 346 L 599.5 347 L 603 345.5 L 601 344.5 L 602.5 344 L 605.5 345 L 605.5 343 L 607.5 344 L 631.5 336 L 633.5 336 L 637 335.5 L 636.5 334 L 639.5 335 L 639.5 333 L 643.5 334 L 643.5 332 L 646.5 333 L 646.5 331 L 649.5 332 L 649.5 330 L 652.5 331 L 652.5 329 L 655.5 330 L 655.5 328 L 659.5 329 L 659.5 328 L 658 327.5 L 659.5 327 L 662.5 328 L 662.5 326 L 665.5 327 L 665.5 325 L 668.5 326 L 668.5 324 L 672 325 L 673.5 322 L 675.5 322 L 711.5 312 L 746.5 305 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 671.5 453 L 675 455.5 L 676 459 L 701 482.5 L 705 487.5 L 705 489.5 L 708 493.5 L 706.5 493 L 700.5 491 L 696.5 493 L 679.5 475 L 678 473.5 L 675 472 L 673 466 L 671 466.5 L 671.5 468 L 669 468.5 Q 671.8 470.3 667.5 472 L 664.5 473 L 660 476.5 Q 662.8 478.3 658.5 480 L 656.5 480 L 652 483.5 L 651.5 486 L 649.5 486 L 646 488.5 L 646.5 490 L 644.5 490 L 642 491.5 L 641.5 494 L 639.5 494 L 637 495.5 L 637.5 497 L 635.5 497 L 633 498.5 L 633.5 500 L 631.5 500 L 629 501.5 L 629.5 503 L 627.5 503 L 626 503.5 L 626.5 505 L 624.5 505 L 623 505.5 L 622.5 508 L 620.5 508 L 619 508.5 L 619.5 510 L 617.5 510 L 616 510.5 L 616.5 512 L 614.5 512 L 613 512.5 L 612.5 515 L 610.5 514 L 609.5 517 L 607.5 516 L 606.5 519 L 604.5 518 L 604.5 520 L 602.5 520 L 601 520.5 L 601.5 522 L 599.5 521 L 598.5 524 L 596.5 523 L 595.5 526 L 593.5 525 L 593.5 527 L 591.5 527 L 590 527.5 L 590.5 529 L 588.5 528 L 588.5 530 L 586.5 530 L 585 530.5 L 585.5 532 L 583.5 531 L 583.5 533 L 581.5 532 L 578 534.5 L 578.5 536 L 576.5 535 L 576.5 537 L 574.5 536 L 574.5 538 L 572.5 537 L 572.5 539 L 570.5 538 L 566 540.5 L 566.5 542 L 564.5 541 L 550 548.5 L 550.5 550 L 548 550.5 L 550 551.5 L 548.5 552 L 529.5 551 L 527 549.5 Q 607.5 515 665.5 458 L 667 458.5 L 671.5 453 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 324.5 551 L 432 551.5 L 324.5 552 L 324.5 551 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 552.5 551 L 632 551.5 L 552.5 552 L 552.5 551 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 532.5 639 L 544 639.5 L 532.5 640 L 532.5 639 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 156.5 688 L 157 698.5 L 156 698.5 L 156.5 688 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 557.5 749 L 568 749.5 L 557.5 750 L 557.5 749 Z "/><path fill="rgb(60,61,64)" stroke="rgb(60,61,64)" stroke-width="0" opacity="0.9607843137254902" d="M 533.5 819 L 544 819.5 L 533.5 820 L 533.5 819 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 325.5 125 L 631.5 125 Q 663.3 129.7 680 149.5 Q 695.3 165.2 699 192.5 L 699 316 L 674.5 323 L 673 320.5 L 674 316.5 L 673 314.5 L 674 309.5 L 673 304.5 L 674 291.5 L 674 289.5 L 673 280.5 L 674 252.5 L 673 248.5 L 674 224.5 L 674 222.5 L 673 218.5 L 674 215.5 L 673 208.5 L 674 205.5 L 673 200.5 L 673 198.5 Q 672.1 171.3 654.5 161 Q 644.9 153.1 629.5 151 L 325.5 151 Q 303.1 155.1 292 170.5 Q 283.8 180.8 282 197.5 L 282 461.5 L 285 459.5 L 379.5 350 Q 383.2 346.7 391.5 348 L 405 359.5 L 439.5 400 L 553.5 266 L 564.5 263 Q 574.5 265 579 272.5 L 633 336.5 L 631.5 336 L 607.5 344 L 563.5 291 L 456 418.5 L 494 461.5 Q 498.7 465.3 499 473.5 L 494.5 482 Q 491.3 485.8 482.5 484 L 475 477.5 L 388.5 376 L 287 493.5 Q 281.8 496.8 282 505.5 Q 284.4 527.4 296 539 Q 306.3 549.1 324.5 552 L 431.5 552 Q 481.5 531.5 520.5 500 Q 566.2 463.7 606 421.5 L 607.5 419 L 609 417.5 L 616 411.5 L 568.5 460 Q 513 515.5 437 550.5 L 448.5 552 L 454.5 551 L 482.5 537 L 532.5 503 Q 579.7 465.7 620 421.5 L 629 411.5 L 587 367.5 L 586 362.5 L 588.5 359 L 765.5 303 Q 771.4 305.6 771 314.5 L 733 487.5 Q 732.4 495.9 727.5 500 L 719.5 502 L 705 490.5 L 704 488.5 L 705 487.5 L 701 483.5 L 672.5 453 Q 610.5 513.5 525 550.5 L 549.5 552 L 551.5 551 L 631.5 552 Q 654.2 548.7 665 533.5 L 673 515.5 L 673.5 468 L 675 472 L 678 473.5 L 679.5 475 L 696.5 493 L 699 493.5 L 699 513.5 Q 694.5 543.5 675.5 559 Q 659.4 574.4 631.5 578 L 325.5 578 Q 289.5 573.5 272 550.5 Q 260.3 537.2 257 515.5 L 257 189.5 Q 263.4 156.4 286.5 140 Q 301.5 128 325.5 125 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 393.5 217 Q 421.5 217.5 432 235.5 Q 440.7 245.3 440 264.5 Q 437 286 422.5 296 Q 412.6 305.1 393.5 305 Q 372.3 302.1 362 288.5 Q 351.1 277.9 353 254.5 Q 356.3 236.3 368.5 227 Q 377.8 218.8 393.5 217 Z M 394 239 L 384 243 Q 377 247 375 256 Q 373 269 379 275 L 393 283 Q 403 284 408 280 Q 416 275 418 263 L 414 249 Q 409 239 394 239 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 663.5 326 L 666 326.5 L 641.5 334 L 641.5 333 L 663.5 326 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 603.5 344 L 606 344.5 L 584.5 351 L 576 357.5 L 575 366.5 L 585 380 L 588 381.5 L 613.5 409 L 615 409.5 L 613.5 410 L 575 369.5 L 574 360.5 L 578.5 353 L 603.5 344 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 671.5 466 L 673 466.5 L 671 467 L 669.5 469 Q 618.1 518.1 549.5 550 L 550.5 548 Q 619.9 515.9 671.5 466 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 207.5 640 Q 256.3 636.2 275 662.5 Q 284 672.8 285 690 L 249.5 692 Q 247.3 679.2 238.5 673 Q 229.8 667.7 213.5 670 Q 202.4 672.4 197 680.5 Q 193.7 685.2 195 694.5 L 201.5 702 L 214.5 708 L 257.5 720 L 279 736.5 Q 289.4 748.1 287 772.5 Q 284.1 789.3 275 799 L 273 800.5 Q 252.1 822.6 205.5 819 Q 178.5 814.5 164 797.5 Q 151.4 784.9 151 761 L 189 759 Q 189 776.1 200.5 783 Q 209.4 789.6 226.5 788 Q 238.7 786.2 245 778.5 Q 250.3 773.8 249 762.5 L 245 754 L 231.5 747 L 201.5 740 L 184.5 734 Q 172.5 729.5 165 720.5 Q 153.8 709.2 157 683.5 Q 161.3 664.3 174.5 654 Q 187 643 207.5 640 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 523.5 640 Q 574.7 635.8 595 662.5 Q 606.5 675.2 609 696 L 579.5 698 L 574.5 700 L 571 688.5 L 560.5 677 Q 551.4 669.1 532.5 671 Q 512.9 674.4 504 688.5 Q 493.9 703.4 493 727.5 L 496 754.5 Q 499.6 769.4 509.5 778 Q 520.7 789.8 545.5 788 Q 563.6 785.6 572 773.5 Q 578 765.3 576 750 L 557.5 749 L 555.5 750 L 547.5 749 L 545.5 750 L 543.5 750 L 542 749.5 L 542 722 L 609 722 L 609 786.5 L 596.5 800 Q 573.5 822.5 524.5 819 Q 492.4 813.6 475 793.5 Q 452.2 768.8 454 719.5 Q 458.1 679.6 481.5 659 Q 497 644 523.5 640 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 292 642 L 295.5 643 L 333 642 L 375.5 777 L 416 645.5 L 418.5 642 L 456.5 642 L 457 643.5 L 398 816 L 351.5 816 L 351 813.5 L 292 642 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 677.5 685 Q 717.2 681.8 733 702.5 Q 750.6 721.6 748 760 L 661.5 760 L 661 762.5 Q 662.9 778.6 673.5 786 Q 680.3 791.7 693.5 791 Q 704.8 788.8 711 781.5 L 715 774 L 749 776.5 Q 743.2 795.7 729.5 807 Q 713.3 821.8 679.5 819 Q 653.4 814.1 640 796.5 Q 624.6 778.9 627 743.5 Q 631 712.5 650.5 697 Q 660.9 687.9 677.5 685 Z M 683 712 L 674 716 Q 666 722 663 732 L 664 737 L 715 737 Q 715 728 710 722 Q 703 710 683 712 Z "/><path fill="rgb(14,16,15)" stroke="rgb(14,16,15)" stroke-width="0" opacity="0.996078431372549" d="M 828.5 685 Q 858 683 869 699.5 Q 877.5 710 879 727.5 L 879 816 L 843 816 L 843 730.5 Q 841.1 721.4 834.5 717 Q 828.3 712.2 815.5 714 L 803 722.5 L 798 735.5 L 798 816 L 763.5 816 L 763 815.5 L 763 687 L 798 687 L 798 703.5 L 799 703.5 L 801 700.5 Q 810.9 688.9 828.5 685 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 327.5 124 L 630 124.5 L 327.5 125 L 327.5 124 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 699.5 197 L 700 312 L 707.5 312 L 708 314 L 702.5 313 L 702.5 314 L 704 314.5 L 702.5 315 L 700 313.5 L 701 315.5 L 699 316 L 699.5 197 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 700.5 491 L 711 496.5 L 708.5 495 L 704.5 496 L 702.5 495 L 701 495.5 L 700.5 493 L 699.5 510 L 699 492.5 L 700.5 491 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 272.5 551 L 282 560.5 L 280.5 562 L 279.5 559 L 277.5 559 L 276 557.5 Q 279.3 555.2 273.5 553 L 272 553.5 L 272.5 551 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 333.5 578 L 349 578.5 L 333.5 579 L 333.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 358.5 578 L 395 578.5 L 358.5 579 L 358.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 399.5 578 L 413 578.5 L 399.5 579 L 399.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 429.5 578 L 453 578.5 L 429.5 579 L 429.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 463.5 578 L 494 578.5 L 463.5 579 L 463.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 495.5 578 L 557 578.5 L 495.5 579 L 495.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 575.5 578 L 586 578.5 L 575.5 579 L 575.5 578 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 239.5 674 L 243.5 679 L 241 677.5 L 242 679.5 L 240 678.5 L 241 676.5 L 239.5 674 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 829.5 684 L 842 684.5 L 829.5 685 L 829.5 684 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 762 686 L 799 686 L 799 702.5 L 798 702.5 L 798 687 L 763 687 L 763 815.5 L 763.5 816 L 798 816 L 798.5 738 L 799 817 L 762.5 817 L 762 816.5 L 762 686 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 648.5 698 L 643.5 704 L 643.5 701 L 644.5 702 L 648.5 698 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 581.5 720 L 589.5 721 L 591.5 721 L 603 721.5 L 567.5 722 L 567.5 721 L 581.5 720 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 541 721 L 544 721.5 L 542 722 L 541.5 752 L 541 721 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 607.5 721 L 610 722.5 L 609.5 786 L 609 722 L 607.5 721 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 453.5 724 L 454 735.5 L 453 735.5 L 453.5 724 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 271.5 728 L 274 728.5 L 273 729.5 L 279.5 737 L 271.5 728 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 879.5 729 L 880 815.5 L 872.5 817 L 872.5 816 L 879 815.5 L 879.5 729 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 714.5 735 L 715 737 L 663 736.5 L 714.5 735 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 626.5 747 L 627 758.5 L 626 758.5 L 626.5 747 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 571.5 750 L 574.5 751 L 576 750.5 L 576 752.5 L 575.5 761 L 575 752 L 571.5 751 L 570 751.5 L 571.5 750 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 287.5 756 L 288 771.5 L 287 771.5 L 287.5 756 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 760.5 774 L 761 788.5 L 760 788.5 L 760.5 774 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 215.5 787 L 226 787.5 L 215.5 788 L 215.5 787 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 532.5 787 L 543 787.5 L 532.5 788 L 532.5 787 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 475.5 794 L 480.5 800 Q 477.3 793.4 474 795.5 L 475.5 794 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 842.5 815 L 868 816.5 L 843.5 817 L 842.5 815 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 353.5 816 L 395 816.5 L 353.5 817 L 353.5 816 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 208.5 819 L 229 819.5 L 208.5 820 L 208.5 819 Z "/><path fill="rgb(68,67,66)" stroke="rgb(68,67,66)" stroke-width="0" opacity="0.1607843137254902" d="M 682.5 819 L 699 819.5 L 682.5 820 L 682.5 819 Z "/></svg>
      
      <h1>PNG → SVG Tracer & detaljeret vektoriseringsværktøj</h1>
    </div>

    <p class="description">
      Upload en PNG og generér en redigerbar, detaljeret SVG. Justér detaljeringsgrad og geometrisk udjævning før konvertering – og finjustér farver/placeringer bagefter. Alt kører lokalt i browseren.
    </p>

    <div class="controls">
      <div class="control">
        <label for="fileInput"><span>PNG-fil</span><span class="badge">Kræver PNG</span></label>
        <input id="fileInput" type="file" accept="image/png" />
        <button id="uploadBtn" class="secondary" style="width:100%; margin-top:8px;">Upload</button>
        <div class="hint">Maks ~12 MB anbefales for hurtig konvertering.</div>
      </div>
      <div class="control">
        <label for="detailRange"><span>Detaljeringsgrad</span><span id="detailValue">7</span></label>
        <input id="detailRange" type="range" min="1" max="10" step="1" value="7" />
        <div class="hint">Højere = flere små kurver (ltres/qtres), lavere = simplere.</div>
      </div>
      <div class="control">
        <label for="smoothRange"><span>Geometrisk udjævning</span><span id="smoothValue">40%</span></label>
        <input id="smoothRange" type="range" min="0" max="100" step="5" value="40" />
        <div class="hint">Styrer blur og form-udglatning før sporingen.</div>
      </div>
      <div class="control">
        <label for="colorsRange"><span>Farvepalet</span><span id="colorsValue">64 farver</span></label>
        <input id="colorsRange" type="range" min="0" max="512" step="1" value="64" />
        <div class="inline-flex" style="gap:10px; align-items:center; margin-top:8px; width:100%;">
          <input id="colorsNumber" type="number" min="0" max="512" step="1" value="64" style="flex:1;" />
          <span class="hint" style="margin:0;">Skriv eller brug pilene for ±1</span>
        </div>
        <div id="colorsWarning" class="hint hidden" style="margin-top:6px;"></div>
        <label style="margin-top:6px; gap:10px; align-items:center; display:flex;">
          <input id="matchPalette" type="checkbox" />
          <span>Match inputfilens palet (kræver upload)</span>
        </label>
        <label style="margin-top:6px; gap:10px; align-items:center; display:flex;">
          <input id="gradientToggle" type="checkbox" />
          <span>Bevar gradienter (øger farvebudget og sampling)</span>
        </label>
        <div class="hint">0 = auto (bruger hele paletten fra input). Med matchet palet kan du vælge 0 til inputfarverne (uanset størrelse); uden match kan du vælge 0-512.</div>
      </div>
    </div>

    <div class="actions">
      <button id="convertBtn">Konvertér til SVG</button>
      <button id="downloadBtn" class="secondary" disabled>Download SVG</button>
      <button id="resetViewBtn" class="secondary">Nulstil visning</button>
      <span class="inline-flex">
        <label for="colorPicker" style="margin:0;">Redigér farve</label>
        <input id="colorPicker" class="swatch" type="color" value="#00ffff" disabled />
      </span>
      <span class="inline-flex">
        <label for="transparentPicker" style="margin:0;">Gør farve transparent</label>
        <input id="transparentPicker" class="swatch" type="color" value="#000000" disabled />
        <button id="makeTransparentBtn" class="secondary" disabled style="padding:8px 12px;">Anvend</button>
      </span>
      <span class="inline-flex" style="flex-wrap:wrap; gap:6px; align-items:center;">
        <label for="glowRange" style="margin:0;">Feather/outer glow (<span id="glowValue">0 px</span>)</label>
        <select id="glowMode" style="min-width:170px;">
          <option value="glow" selected>Kun feather/outer glow</option>
          <option value="outline">Kun outline</option>
          <option value="both">Outline + glow</option>
        </select>
        <input id="glowRange" type="range" min="0" max="50" step="1" value="0" style="flex:1;" />
        <input id="glowNumber" type="number" min="0" max="50" step="1" value="0" style="width:90px;" />
        <input id="glowColor" class="swatch" type="color" value="#00ffff" />
      </span>
      <span class="inline-flex" style="flex-wrap:wrap; gap:6px; align-items:center;">
        <label for="bgColorPicker" style="margin:0;">Baggrund → transparent</label>
        <input id="bgColorPicker" class="swatch" type="color" value="#000000" />
        <button id="sampleBgBtn" class="secondary" style="padding:8px 12px;">Vælg fra PNG</button>
        <button id="applyBgRemovalBtn" class="secondary" style="padding:8px 12px;">Fjern baggrund</button>
      </span>
      <span class="inline-flex" style="flex-wrap:wrap; gap:6px; align-items:center;">
        <label for="exportWidth" style="margin:0;">Outputstørrelse (px)</label>
        <input id="exportWidth" type="number" min="1" step="1" value="1024" style="width:90px;" />
        <span style="color:var(--muted);">×</span>
        <input id="exportHeight" type="number" min="1" step="1" value="1024" style="width:90px;" />
        <label style="display:flex; align-items:center; gap:6px; margin:0;">
          <input id="lockAspect" type="checkbox" checked />
          <span>Lås højde/bredde-forhold</span>
        </label>
      </span>
    </div>

    <div class="actions" style="flex-wrap:wrap;">
      <button id="deleteBtn" class="secondary" disabled>Slet valgte</button>
      <button id="rotateLeftBtn" class="secondary" disabled>Rotér -15°</button>
      <button id="rotateRightBtn" class="secondary" disabled>Rotér +15°</button>
      <button id="flipHBtn" class="secondary" disabled>Spejlvend horisontalt</button>
      <button id="flipVBtn" class="secondary" disabled>Spejlvend vertikalt</button>
      <button id="alignLeftBtn" class="secondary" disabled>Align venstre</button>
      <button id="alignCenterBtn" class="secondary" disabled>Align center</button>
      <button id="alignRightBtn" class="secondary" disabled>Align højre</button>
      <button id="alignTopBtn" class="secondary" disabled>Align top</button>
      <button id="alignMiddleBtn" class="secondary" disabled>Align midte</button>
      <button id="alignBottomBtn" class="secondary" disabled>Align bund</button>
      <span class="badge">Tip: Klik et SVG-objekt for at markere og trække i det. Marker flere elementer med Ctrl/⌘ eller Shift for alignment.</span>
    </div>

    <div class="status" id="status"></div>

    <div class="panels">
      <div class="panel">
        <h2>Input preview</h2>
        <div class="viewport" id="previewViewport">
          <div class="viewport-inner" id="previewInner">
            <canvas id="previewCanvas" width="10" height="10" style="width:100%;height:auto;"></canvas>
          </div>
        </div>
        <div class="hint">Forvisning af PNG'en der spores (skaleres automatisk til canvas-størrelse). Zoom med musehjulet og panorér ved at holde venstre musetast nede – udsnittet spejles automatisk til SVG-visningen.</div>
      </div>
      <div class="panel">
        <h2>SVG</h2>
        <div id="svgOutput" aria-live="polite">
          <div class="viewport" id="svgViewport">
            <div class="viewport-inner" id="svgInner"></div>
            <div class="selection-overlay" id="selectionOverlay"></div>
          </div>
        </div>
      </div>
      <div class="panel">
        <h2>Log & hjælp</h2>
        <div class="hint">
          <ul>
            <li>Kontrollér at filen er PNG. Andre formater afvises for at undgå fejl.</li>
            <li>Brug "Detaljeringsgrad" til at balancere præcision vs. filstørrelse.</li>
            <li>"Geometrisk udjævning" justerer blur og simplificering før sporingen.</li>
            <li>Klik på et SVG-element for at vælge det. Brug farvevælgeren til at ændre fill, og træk for at flytte.</li>
            <li>Download-knappen aktiveres efter en succesfuld konvertering.</li>
            <li>Zoom og panorér kun i PNG-previewet (venstreklik+træk for pan); udsnittet spejles automatisk til SVG-visningen.</li>
            <li>Hold Shift nede og træk i SVG-visningen for at markere flere elementer med en ramme.</li>
            <li>Brug "Vælg fra PNG" + "Fjern baggrund" til at gøre baggrunden transparent, og angiv outputstørrelse/forhold før download.</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <script>
    const fileInput = document.getElementById('fileInput');
    const detailRange = document.getElementById('detailRange');
    const smoothRange = document.getElementById('smoothRange');
    const colorsRange = document.getElementById('colorsRange');
    const colorsNumber = document.getElementById('colorsNumber');
    const colorsWarning = document.getElementById('colorsWarning');
    const gradientToggle = document.getElementById('gradientToggle');
    const matchPalette = document.getElementById('matchPalette');
    const detailValue = document.getElementById('detailValue');
    const smoothValue = document.getElementById('smoothValue');
    const colorsValue = document.getElementById('colorsValue');
    const uploadBtn = document.getElementById('uploadBtn');
    const convertBtn = document.getElementById('convertBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetViewBtn = document.getElementById('resetViewBtn');
    const svgOutput = document.getElementById('svgOutput');
    const svgInner = document.getElementById('svgInner');
    const svgViewport = document.getElementById('svgViewport');
    const statusEl = document.getElementById('status');
    const colorPicker = document.getElementById('colorPicker');
    const transparentPicker = document.getElementById('transparentPicker');
    const makeTransparentBtn = document.getElementById('makeTransparentBtn');
    const previewCanvas = document.getElementById('previewCanvas');
    const previewCtx = previewCanvas.getContext('2d');
    const previewInner = document.getElementById('previewInner');
    const previewViewport = document.getElementById('previewViewport');
    const deleteBtn = document.getElementById('deleteBtn');
    const rotateLeftBtn = document.getElementById('rotateLeftBtn');
    const rotateRightBtn = document.getElementById('rotateRightBtn');
    const flipHBtn = document.getElementById('flipHBtn');
    const flipVBtn = document.getElementById('flipVBtn');
    const alignLeftBtn = document.getElementById('alignLeftBtn');
    const alignCenterBtn = document.getElementById('alignCenterBtn');
    const alignRightBtn = document.getElementById('alignRightBtn');
    const alignTopBtn = document.getElementById('alignTopBtn');
    const alignMiddleBtn = document.getElementById('alignMiddleBtn');
    const alignBottomBtn = document.getElementById('alignBottomBtn');
    const glowRange = document.getElementById('glowRange');
    const glowNumber = document.getElementById('glowNumber');
    const glowValue = document.getElementById('glowValue');
    const glowMode = document.getElementById('glowMode');
    const glowColor = document.getElementById('glowColor');
    const bgColorPicker = document.getElementById('bgColorPicker');
    const sampleBgBtn = document.getElementById('sampleBgBtn');
    const applyBgRemovalBtn = document.getElementById('applyBgRemovalBtn');
    const exportWidth = document.getElementById('exportWidth');
    const exportHeight = document.getElementById('exportHeight');
    const lockAspect = document.getElementById('lockAspect');
    const selectionOverlay = document.getElementById('selectionOverlay');

    function tracerIsReady() {
      return (
        typeof ImageTracer === 'object' &&
        ImageTracer !== null &&
        typeof ImageTracer.imagedataToSVG === 'function'
      );
    }

    let tracerReady = tracerIsReady();

    let lastSVG = '';
    let selectedElements = [];
    let dragOrigin = null;
    let inputPaletteSize = null;
    let editingListenersBound = false;
    let cachedImageData = null;
    let cachedImageSignature = null;
    let currentFileBase = 'vectorized';
    let originalDimensions = { width: 1024, height: 1024 };
    let backgroundPickMode = false;
    let boxSelectState = null;

    function captureCurrentSVG() {
      const svgEl = svgOutput.querySelector('svg');
      if (!svgEl) return;
      lastSVG = new XMLSerializer().serializeToString(svgEl);
    }

    const MAX_BYTES = 12 * 1024 * 1024; // ~12MB
    const DEFAULT_MAX_COLORS = 512;
    const MIN_SCALE = 0.25;
    const MAX_SCALE = 6;
    const SVG_NS = 'http://www.w3.org/2000/svg';
    const GLOW_FILTER_ID = 'outer-glow-filter';
    const viewportState = { scale: 1, x: 0, y: 0 };
    let isPanning = false;
    let panOrigin = null;
    let spaceHeld = false;
    let viewportListenersBound = false;
    let aspectRatio = 1;
    let exportManualChange = false;

    function computePaletteSize(imageData) {
      const { data } = imageData;
      const seen = new Set();
      for (let i = 0; i < data.length; i += 4) {
        const alpha = data[i + 3];
        if (alpha === 0) continue;
        const key = `${data[i]},${data[i + 1]},${data[i + 2]}`;
        seen.add(key);
      }
      return seen.size;
    }

    function fileSignature(file) {
      return file ? `${file.name}-${file.size}-${file.lastModified}` : null;
    }

    function updateLabels() {
      detailValue.textContent = detailRange.value;
      smoothValue.textContent = `${smoothRange.value}%`;
      colorsNumber.value = colorsRange.value;
      colorsValue.textContent =
        colorsRange.value === '0'
          ? `Auto (0-${colorsRange.max} farver)`
          : `${colorsRange.value} farver`;
    }

    function paletteWarningState(value) {
      const warnOrange = value > 128 && value <= 256;
      const warnRed = value > 256;

      colorsRange.classList.toggle('warn-orange', warnOrange && !warnRed);
      colorsRange.classList.toggle('warn-red', warnRed);

      let message = '';
      if (warnRed) {
        message = 'Stor palet (>256) kan give meget lang behandlingstid og potentielt nedbrud.';
        colorsWarning.style.color = '#fca5a5';
      } else if (warnOrange) {
        message = 'Stor palet (>128) kan tage lang tid at spore.';
        colorsWarning.style.color = '#fdba74';
      }

      colorsWarning.textContent = message;
      colorsWarning.classList.toggle('hidden', !message);
    }

    updateLabels();
    paletteWarningState(Number(colorsRange.value));
    syncGlow(Number(glowRange.value));

    function clearCachedImage() {
      cachedImageData = null;
      cachedImageSignature = null;
      inputPaletteSize = null;
      refreshColorBounds();
    }

    function currentColorMax() {
      if (matchPalette.checked && inputPaletteSize) {
        return Math.max(0, inputPaletteSize);
      }
      return DEFAULT_MAX_COLORS;
    }

    function clampColorValue(value, maxOverride) {
      const max = Math.max(0, maxOverride ?? currentColorMax());
      if (!Number.isFinite(value)) return 0;
      return Math.min(Math.max(0, Math.round(value)), max);
    }

    function applyColorValue(value) {
      const clamped = clampColorValue(value);
      colorsRange.value = String(clamped);
      colorsNumber.value = String(clamped);
      updateLabels();
      paletteWarningState(clamped);
    }

    function refreshColorBounds() {
      const max = currentColorMax();
      colorsRange.max = String(max);
      colorsNumber.max = String(max);
      applyColorValue(Number(colorsRange.value));
    }

    [detailRange, smoothRange].forEach((el) => {
      el.addEventListener('input', updateLabels);
    });

    colorsRange.addEventListener('input', () => {
      applyColorValue(Number(colorsRange.value));
    });

    colorsNumber.addEventListener('input', () => {
      applyColorValue(Number(colorsNumber.value));
    });

    refreshColorBounds();

    exportWidth.addEventListener('input', () => {
      exportManualChange = true;
      const width = clampDimension(exportWidth.value, originalDimensions.width || 1024);
      if (!lockAspect.checked) {
        const height = clampDimension(exportHeight.value, originalDimensions.height || 1024);
        aspectRatio = height > 0 ? width / height : aspectRatio;
      }
      syncExportFromWidth(width);
    });

    exportHeight.addEventListener('input', () => {
      exportManualChange = true;
      const height = clampDimension(exportHeight.value, originalDimensions.height || 1024);
      if (!lockAspect.checked) {
        const width = clampDimension(exportWidth.value, originalDimensions.width || 1024);
        aspectRatio = height > 0 ? width / height : aspectRatio;
      }
      syncExportFromHeight(height);
    });

    lockAspect.addEventListener('change', () => {
      const width = clampDimension(exportWidth.value, originalDimensions.width || 1024);
      const height = clampDimension(exportHeight.value, originalDimensions.height || 1024);
      aspectRatio = height > 0 ? width / height : aspectRatio;
      if (lockAspect.checked) {
        syncExportFromWidth(width);
      }
    });

    uploadBtn.addEventListener('click', async (event) => {
      event.preventDefault();
      const file = fileInput.files?.[0];
      if (!file) {
        fileInput.click();
        return;
      }
      await loadImageFromFile(file).catch(() => {});
    });

    fileInput.addEventListener('change', () => {
      clearCachedImage();
      lastSVG = '';
      svgInner.replaceChildren();
      downloadBtn.disabled = true;
      clearSelection();
      updateEditControls();
      backgroundPickMode = false;
      if (fileInput.files?.[0]) {
        setStatus('Fil valgt. Klik Upload for at indlæse previewet eller konvertér til SVG.');
      }
    });

    matchPalette.addEventListener('change', () => {
      if (matchPalette.checked) {
        if (!inputPaletteSize) {
          setStatus('Upload en PNG for at kunne matche dens palet.', true);
          matchPalette.checked = false;
          refreshColorBounds();
          return;
        }
        refreshColorBounds();
        applyColorValue(inputPaletteSize);
        setStatus(`Matchede paletstørrelse fra input (${inputPaletteSize} farver).`);
      } else {
        refreshColorBounds();
        setStatus('Paletmatch slået fra. Intervallet er 0-512 farver.');
      }
    });

    updateEditControls();

    function setStatus(message, isError = false) {
      statusEl.textContent = message;
      statusEl.style.color = isError ? '#fda4af' : 'var(--muted)';
    }

    function applyViewport() {
      const transform = `translate(${viewportState.x}px, ${viewportState.y}px) scale(${viewportState.scale})`;
      [previewInner, svgInner].forEach((el) => {
        if (el) {
          el.style.transform = transform;
        }
      });
    }

    function resetViewport() {
      viewportState.scale = 1;
      viewportState.x = 0;
      viewportState.y = 0;
      applyViewport();
    }

    function zoomAt(container, clientX, clientY, factor) {
      const rect = container.getBoundingClientRect();
      const cx = clientX - (rect.left + rect.width / 2);
      const cy = clientY - (rect.top + rect.height / 2);
      const prevScale = viewportState.scale;
      const nextScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, prevScale * factor));
      const ratio = nextScale / prevScale;
      viewportState.x = cx + (viewportState.x - cx) * ratio;
      viewportState.y = cy + (viewportState.y - cy) * ratio;
      viewportState.scale = nextScale;
      applyViewport();
    }

    function bindViewportInteractions(container) {
      if (!container) return;
      container.addEventListener('wheel', (event) => {
        event.preventDefault();
        const factor = event.deltaY < 0 ? 1.1 : 0.9;
        zoomAt(container, event.clientX, event.clientY, factor);
      }, { passive: false });

      container.addEventListener('contextmenu', (event) => event.preventDefault());

      container.addEventListener('mousedown', (event) => {
        const isPrimary = event.button === 0;
        if (!isPrimary) return;
        if (backgroundPickMode && container === previewViewport) {
          event.preventDefault();
          pickBackgroundFromEvent(event);
          backgroundPickMode = false;
          return;
        }
        event.preventDefault();
        isPanning = true;
        panOrigin = {
          startX: event.clientX,
          startY: event.clientY,
          x: viewportState.x,
          y: viewportState.y,
        };
        container.classList.add('dragging');
      });

      if (!viewportListenersBound) {
        window.addEventListener('mousemove', (event) => {
          if (!isPanning || !panOrigin) return;
          const dx = event.clientX - panOrigin.startX;
          const dy = event.clientY - panOrigin.startY;
          viewportState.x = panOrigin.x + dx;
          viewportState.y = panOrigin.y + dy;
          applyViewport();
        });

        const stopPan = () => {
          isPanning = false;
          panOrigin = null;
          previewViewport.classList.remove('dragging');
          svgViewport.classList.remove('dragging');
        };

        window.addEventListener('mouseup', stopPan);
        window.addEventListener('mouseleave', stopPan);
        viewportListenersBound = true;
      }
    }

    window.addEventListener('keydown', (event) => {
      if (event.code === 'Space') {
        spaceHeld = true;
      }
    });

    window.addEventListener('keyup', (event) => {
      if (event.code === 'Space') {
        spaceHeld = false;
      }
    });

    bindViewportInteractions(previewViewport);
    applyViewport();

    svgViewport.addEventListener('mousedown', (event) => {
      const svgEl = svgOutput.querySelector('svg');
      if (!svgEl) return;
      if (!event.shiftKey || event.button !== 0) return;
      event.preventDefault();
      const rect = svgViewport.getBoundingClientRect();
      boxSelectState = {
        startX: event.clientX,
        startY: event.clientY,
        additive: event.ctrlKey || event.metaKey || event.shiftKey,
      };
      updateSelectionOverlay({ x: event.clientX - rect.left, y: event.clientY - rect.top, width: 0, height: 0 });
    });

    window.addEventListener('mousemove', (event) => {
      if (!boxSelectState) return;
      event.preventDefault();
      const rect = svgViewport.getBoundingClientRect();
      const left = Math.min(boxSelectState.startX, event.clientX);
      const top = Math.min(boxSelectState.startY, event.clientY);
      const right = Math.max(boxSelectState.startX, event.clientX);
      const bottom = Math.max(boxSelectState.startY, event.clientY);
      updateSelectionOverlay({ x: left - rect.left, y: top - rect.top, width: right - left, height: bottom - top });
    });

    const finishBoxSelection = (event) => {
      if (!boxSelectState) return;
      const svgEl = svgOutput.querySelector('svg');
      const { startX, startY, additive } = boxSelectState;
      boxSelectState = null;
      updateSelectionOverlay(null);
      if (!svgEl) return;

      const left = Math.min(startX, event.clientX);
      const top = Math.min(startY, event.clientY);
      const right = Math.max(startX, event.clientX);
      const bottom = Math.max(startY, event.clientY);

      const nodes = svgEl.querySelectorAll('path, rect, circle, ellipse, polygon, polyline, g');
      const hits = Array.from(nodes).filter((node) => {
        if (!(node instanceof SVGElement)) return false;
        const rect = node.getBoundingClientRect();
        return !(rect.right < left || rect.left > right || rect.bottom < top || rect.top > bottom);
      });

      applyGroupSelection(hits, additive);
      setStatus(
        hits.length > 0
          ? `Markerede ${hits.length} element(er) med markørramme.`
          : 'Ingen elementer fanget af markørrammen.',
      );
    };

    window.addEventListener('mouseup', finishBoxSelection);
    window.addEventListener('mouseleave', finishBoxSelection);

    resetViewBtn.addEventListener('click', () => {
      resetViewport();
      setStatus('Visning nulstillet for begge canvasser.');
    });

    window.addEventListener('load', () => {
      tracerReady = tracerIsReady();
      if (!tracerReady) {
        setStatus(
          'ImageTracer blev ikke indlæst lokalt. Forsøger automatisk online fallback …',
          true,
        );
        loadTracerFallback().then((ready) => {
          tracerReady = ready;
          if (ready) {
            setStatus('ImageTracer indlæst via fallback. Upload en PNG for at starte.');
          } else {
            setStatus(
              'ImageTracer kunne ikke indlæses. Sørg for at vendor/imagetracer_v1.2.6.js er tilgængelig eller tjek internetforbindelsen.',
              true,
            );
          }
        });
      } else {
        setStatus('ImageTracer klar. Upload en PNG for at starte.');
      }
    });

    function ensurePNG(file) {
      if (!file) {
        setStatus('Vælg venligst en PNG-fil.');
        return false;
      }
      if (file.type !== 'image/png') {
        setStatus('Kun PNG-filer understøttes for at sikre korrekt vektorisering.', true);
        return false;
      }
      if (file.size > MAX_BYTES) {
        setStatus('Filen er stor. Prøv en mindre PNG (<12 MB) for hurtigere resultat.', true);
        return false;
      }
      return true;
    }

    function mapOptions() {
      const detail = Number(detailRange.value); // 1-10
      const smooth = Number(smoothRange.value) / 100; // 0-1
      const colors = Number(colorsRange.value);
      const gradientAware = gradientToggle.checked;

      // Tighter thresholds for more detaljer: ltres/qtres lower => more points
      const ltres = 2 - (detail - 1) * 0.18; // from ~2 to ~0.2
      const qtres = 2 - (detail - 1) * 0.19; // from ~2 to ~0.1
      const pathomit = Math.max(0, 25 - detail * 2.2); // drop tiny paths when low detail

      // Geometric smoothing toggles a light blur before tracing
      const blurradius = smooth * 1.4; // 0 - 1.4
      const blurdelta = Math.max(0.05, 0.35 - smooth * 0.25);

      const colorBudget = colors === 0 ? Math.max(1, inputPaletteSize || 64) : colors;

      return {
        ltres: Math.max(0.05, ltres),
        qtres: Math.max(0.02, qtres),
        pathomit,
        rightangleenhance: true,
        linefilter: true,
        numberofcolors: colorBudget,
        mincolorratio: gradientAware ? 0.002 : 0.02,
        colorquantcycles: gradientAware ? 12 : 4,
        colorsampling: gradientAware ? 2 : 1,
        layering: gradientAware ? 1 : 0,
        blurradius,
        blurdelta,
        strokewidth: 0,
        scale: 1,
      };
    }

    function rgbaToHex(r, g, b) {
      const clamp = (v) => Math.max(0, Math.min(255, Math.round(v)));
      return `#${[clamp(r), clamp(g), clamp(b)]
        .map((v) => v.toString(16).padStart(2, '0'))
        .join('')}`;
    }

    function samplePixel(imageData, x = 0, y = 0) {
      if (!imageData) return null;
      const { width, height, data } = imageData;
      const cx = Math.min(width - 1, Math.max(0, Math.round(x)));
      const cy = Math.min(height - 1, Math.max(0, Math.round(y)));
      const idx = (cy * width + cx) * 4;
      return {
        hex: rgbaToHex(data[idx], data[idx + 1], data[idx + 2]),
        alpha: data[idx + 3],
      };
    }

    function detectBackgroundColor(imageData) {
      if (!imageData) return null;
      const samples = [
        samplePixel(imageData, 0, 0),
        samplePixel(imageData, imageData.width - 1, 0),
        samplePixel(imageData, 0, imageData.height - 1),
        samplePixel(imageData, imageData.width - 1, imageData.height - 1),
      ].filter((s) => s && s.alpha > 0);

      if (samples.length === 0) return '#000000';

      const avg = samples.reduce(
        (acc, s) => ({
          r: acc.r + parseInt(s.hex.slice(1, 3), 16),
          g: acc.g + parseInt(s.hex.slice(3, 5), 16),
          b: acc.b + parseInt(s.hex.slice(5, 7), 16),
        }),
        { r: 0, g: 0, b: 0 },
      );
      const count = samples.length;
      return rgbaToHex(avg.r / count, avg.g / count, avg.b / count);
    }

    function clampDimension(value, fallback) {
      const num = Number(value);
      if (!Number.isFinite(num) || num <= 0) return fallback;
      return Math.max(1, Math.round(num));
    }

    function syncExportFromWidth(width) {
      const safeWidth = clampDimension(width, originalDimensions.width || 1024);
      if (lockAspect.checked && aspectRatio > 0) {
        const nextHeight = Math.max(1, Math.round(safeWidth / aspectRatio));
        exportHeight.value = String(nextHeight);
      }
      exportWidth.value = String(safeWidth);
    }

    function syncExportFromHeight(height) {
      const safeHeight = clampDimension(height, originalDimensions.height || 1024);
      if (lockAspect.checked && aspectRatio > 0) {
        const nextWidth = Math.max(1, Math.round(safeHeight * aspectRatio));
        exportWidth.value = String(nextWidth);
      }
      exportHeight.value = String(safeHeight);
    }

    function setExportDefaults(width, height) {
      const safeW = clampDimension(width, 1024);
      const safeH = clampDimension(height, 1024);
      aspectRatio = safeH === 0 ? 1 : safeW / safeH;
      originalDimensions = { width: safeW, height: safeH };
      exportManualChange = false;
      exportWidth.value = String(safeW);
      exportHeight.value = String(safeH);
    }

    async function loadImageFromFile(file, { silentStatus = false } = {}) {
      if (!ensurePNG(file) || !previewCtx) {
        throw new Error('Ugyldig PNG');
      }

      const signature = fileSignature(file);
      currentFileBase = file.name ? file.name.replace(/\.[^.]+$/, '') : 'vectorized';

      return new Promise((resolve, reject) => {
        if (!silentStatus) {
          setStatus('Indlæser fil …');
        }

        const reader = new FileReader();

        reader.onload = () => {
          const dataUrl = typeof reader.result === 'string' ? reader.result : '';
          if (!dataUrl) {
            setStatus('Kunne ikke læse filen.', true);
            reject(new Error('Læsning fejlede'));
            return;
          }

          const img = new Image();
          img.onload = () => {
            const maxDim = 1024;
            const scale = Math.min(1, maxDim / Math.max(img.width, img.height));
            const width = Math.max(1, Math.round(img.width * scale));
            const height = Math.max(1, Math.round(img.height * scale));

            setExportDefaults(img.width, img.height);

            previewCanvas.width = width;
            previewCanvas.height = height;
            previewCtx.clearRect(0, 0, width, height);
            previewCtx.drawImage(img, 0, 0, width, height);

            const imageData = previewCtx.getImageData(0, 0, width, height);
            cachedImageData = imageData;
            cachedImageSignature = signature;
            inputPaletteSize = computePaletteSize(imageData);
            const bgGuess = detectBackgroundColor(imageData);
            if (bgGuess) {
              bgColorPicker.value = bgGuess;
            }
            refreshColorBounds();

            if (inputPaletteSize) {
              const baseMessage = `Opdagede ${inputPaletteSize} unikke farver i input.`;
              if (matchPalette.checked) {
                applyColorValue(inputPaletteSize);
                setStatus(`${baseMessage} Spændet matcher nu input-paletten (0-${inputPaletteSize}).`);
              } else {
                setStatus(`${baseMessage} Spændet forbliver 0-${colorsRange.max} med mindre du matcher paletten.`);
              }
            } else if (!silentStatus) {
              setStatus('PNG indlæst. Klar til konvertering.');
            }

            resetViewport();
            resolve(imageData);
          };

          img.onerror = () => {
            setStatus('Kunne ikke indlæse billedet. Kontroller at filen er en gyldig PNG.', true);
            reject(new Error('PNG load fejlede'));
          };

          img.src = dataUrl;
        };

        reader.onerror = () => {
          setStatus('Kunne ikke læse filen.', true);
          reject(new Error('Fil-læsning fejlede'));
        };

        reader.readAsDataURL(file);
      });
    }

    async function ensureImageData() {
      const file = fileInput.files?.[0];
      if (!ensurePNG(file) || !previewCtx) return null;

      const signature = fileSignature(file);
      if (cachedImageData && cachedImageSignature === signature) {
        return cachedImageData;
      }

      try {
        const data = await loadImageFromFile(file);
        return data;
      } catch (error) {
        console.error(error);
        return null;
      }
    }

    function pickBackgroundFromEvent(event) {
      if (!cachedImageData) {
        setStatus('Upload og indlæs en PNG før du sampler baggrundsfarven.', true);
        return;
      }
      const rect = previewCanvas.getBoundingClientRect();
      if (!rect.width || !rect.height) return;
      const relX = ((event.clientX - rect.left) / rect.width) * cachedImageData.width;
      const relY = ((event.clientY - rect.top) / rect.height) * cachedImageData.height;
      const sample = samplePixel(cachedImageData, relX, relY);
      if (sample) {
        bgColorPicker.value = sample.hex;
        setStatus(`Valgte baggrundsfarve ${sample.hex} fra PNG. Klik "Fjern baggrund" for at gøre den transparent.`);
      }
    }

    function loadTracerFallback() {
      return new Promise((resolve) => {
        if (tracerIsReady()) {
          resolve(true);
          return;
        }

        const existing = document.getElementById('imagetracer-cdn');
        if (existing) {
          existing.addEventListener('load', () => resolve(tracerIsReady()));
          existing.addEventListener('error', () => resolve(false));
          return;
        }

        const script = document.createElement('script');
        script.id = 'imagetracer-cdn';
        script.src = 'https://unpkg.com/imagetracerjs@1.2.6/imagetracer_v1.2.6.js';
        script.crossOrigin = 'anonymous';
        script.referrerPolicy = 'no-referrer';
        script.onload = () => resolve(tracerIsReady());
        script.onerror = () => resolve(false);
        document.head.appendChild(script);
      });
    }

    async function ensureTracer() {
      tracerReady = tracerIsReady();
      if (tracerReady) return true;

      setStatus('Forsøger at hente ImageTracer online …');
      const loaded = await loadTracerFallback();
      tracerReady = loaded;
      if (loaded) return true;

      setStatus(
        'ImageTracer kunne ikke initialiseres. Tjek at vendor/imagetracer_v1.2.6.js ligger ved siden af denne HTML og at der er internetadgang til fallback.',
        true,
      );
      return false;
    }

    function updateEditControls() {
      const hasSelection = selectedElements.length > 0;
      const multiSelect = selectedElements.length > 1;

      [deleteBtn, rotateLeftBtn, rotateRightBtn, flipHBtn, flipVBtn].forEach((btn) => {
        btn.disabled = !hasSelection;
      });

      [alignLeftBtn, alignCenterBtn, alignRightBtn, alignTopBtn, alignMiddleBtn, alignBottomBtn].forEach((btn) => {
        btn.disabled = !multiSelect;
      });

      colorPicker.disabled = !hasSelection;
      transparentPicker.disabled = !svgOutput.querySelector('svg');
      makeTransparentBtn.disabled = !svgOutput.querySelector('svg');
    }

    function clearSelection() {
      selectedElements.forEach((el) => {
        el.style.outline = '';
      });
      selectedElements = [];
      updateEditControls();
    }

    function syncColorPickerToSelection() {
      const lastSelected = selectedElements[selectedElements.length - 1];
      if (lastSelected) {
        const fill = lastSelected.getAttribute('fill');
        if (fill && fill !== 'none') {
          colorPicker.value = toHex(fill) || colorPicker.value;
        }
      }
    }

    function applySelection(target, additive) {
      if (!additive) clearSelection();
      if (selectedElements.includes(target)) {
        if (additive) {
          target.style.outline = '';
          selectedElements = selectedElements.filter((el) => el !== target);
        }
      } else {
        target.style.outline = '1px solid #38bdf8';
        selectedElements.push(target);
      }
      syncColorPickerToSelection();
      updateEditControls();
    }

    function applyGroupSelection(targets, additive) {
      if (!additive) {
        clearSelection();
      }
      targets.forEach((target) => {
        if (!selectedElements.includes(target)) {
          target.style.outline = '1px solid #38bdf8';
          selectedElements.push(target);
        }
      });
      syncColorPickerToSelection();
      updateEditControls();
    }

    function updateSelectionOverlay(box) {
      if (!selectionOverlay) return;
      if (!box) {
        selectionOverlay.style.display = 'none';
        selectionOverlay.style.width = '0px';
        selectionOverlay.style.height = '0px';
        return;
      }
      selectionOverlay.style.display = 'block';
      selectionOverlay.style.left = `${box.x}px`;
      selectionOverlay.style.top = `${box.y}px`;
      selectionOverlay.style.width = `${box.width}px`;
      selectionOverlay.style.height = `${box.height}px`;
    }

    function getTransformState(el) {
      const tx = Number(el.dataset.tx || '0');
      const ty = Number(el.dataset.ty || '0');
      const rot = Number(el.dataset.rot || '0');
      const sx = Number(el.dataset.sx || '1');
      const sy = Number(el.dataset.sy || '1');
      return { tx, ty, rot, sx, sy };
    }

    function setTransformState(el, state) {
      const { tx, ty, rot, sx, sy } = state;
      el.dataset.tx = tx;
      el.dataset.ty = ty;
      el.dataset.rot = rot;
      el.dataset.sx = sx;
      el.dataset.sy = sy;
      el.setAttribute('transform', `translate(${tx} ${ty}) rotate(${rot}) scale(${sx} ${sy})`);
    }

    function attachEditing(svgRoot) {
      svgRoot.addEventListener('click', (event) => {
        if (!(event.target instanceof SVGElement)) return;
        const additive = event.shiftKey || event.metaKey || event.ctrlKey;
        applySelection(event.target, additive);
      });

      svgRoot.addEventListener('mousedown', (event) => {
        if (spaceHeld) return;
        if (!(event.target instanceof SVGElement)) return;
        const primary = selectedElements[0];
        if (!primary || event.target !== primary) return;
        const { clientX, clientY } = event;
        const { tx, ty } = getTransformState(primary);
        dragOrigin = { clientX, clientY, tx, ty };
      });

      if (!editingListenersBound) {
        window.addEventListener('mousemove', (event) => {
          if (!dragOrigin || selectedElements.length === 0) return;
          event.preventDefault();
          const scale = viewportState.scale || 1;
          const dx = (event.clientX - dragOrigin.clientX) / scale;
          const dy = (event.clientY - dragOrigin.clientY) / scale;
          const primary = selectedElements[0];
          const state = getTransformState(primary);
          const nx = dragOrigin.tx + dx;
          const ny = dragOrigin.ty + dy;
          const newState = { ...state, tx: nx, ty: ny };
          setTransformState(primary, newState);
        });

        window.addEventListener('mouseup', () => {
          if (!dragOrigin) return;
          dragOrigin = null;
          captureCurrentSVG();
        });

        window.addEventListener('keydown', (event) => {
          if (event.key === 'Delete' || event.key === 'Backspace') {
            if (selectedElements.length > 0) {
              event.preventDefault();
              deleteSelected();
            }
          }
        });

        editingListenersBound = true;
      }
    }

    function toHex(color) {
      const ctx = document.createElement('canvas').getContext('2d');
      if (!ctx) return null;
      ctx.fillStyle = color;
      return ctx.fillStyle.match(/^#[0-9a-fA-F]{6}$/) ? ctx.fillStyle : null;
    }

    colorPicker.addEventListener('input', () => {
      if (selectedElements.length === 0) return;
      selectedElements.forEach((el) => {
        el.setAttribute('fill', colorPicker.value);
      });
      captureCurrentSVG();
      setStatus('Opdaterede farve på markerede elementer.');
    });

    makeTransparentBtn.addEventListener('click', () => {
      makeColorTransparent(transparentPicker.value);
    });

    sampleBgBtn.addEventListener('click', () => {
      if (!cachedImageData) {
        setStatus('Upload en PNG før du vælger baggrundsfarve.', true);
        return;
      }
      backgroundPickMode = true;
      setStatus('Klik i PNG-previewet for at vælge baggrundsfarven.');
    });

    applyBgRemovalBtn.addEventListener('click', () => {
      removeBackgroundByColor(bgColorPicker.value);
    });

    function syncGlow(value) {
      const clamped = Math.max(0, Math.min(50, Math.round(value)));
      glowRange.value = String(clamped);
      glowNumber.value = String(clamped);
      glowValue.textContent = `${clamped} px`;
      applyGlowToSVG();
    }

    glowRange.addEventListener('input', () => syncGlow(Number(glowRange.value)));
    glowNumber.addEventListener('input', () => syncGlow(Number(glowNumber.value)));
    glowMode.addEventListener('change', applyGlowToSVG);
    glowColor.addEventListener('input', applyGlowToSVG);

    function renderSVG(svgString) {
      const parsed = new DOMParser().parseFromString(svgString, 'image/svg+xml');
      const svgEl = parsed.querySelector('svg');
      if (!svgEl) {
        setStatus('Kunne ikke læse SVG-resultatet.', true);
        return;
      }

      const widthAttr = parseFloat(svgEl.getAttribute('width') || '0');
      const heightAttr = parseFloat(svgEl.getAttribute('height') || '0');
      if (!svgEl.getAttribute('viewBox') && widthAttr > 0 && heightAttr > 0) {
        svgEl.setAttribute('viewBox', `0 0 ${widthAttr} ${heightAttr}`);
      }

      svgEl.removeAttribute('width');
      svgEl.removeAttribute('height');
      svgEl.classList.add('svg-canvas');
      svgEl.setAttribute('preserveAspectRatio', 'xMidYMid meet');
      svgEl.style.background = 'transparent';

      const viewBoxAttr = svgEl.getAttribute('viewBox');
      if (viewBoxAttr) {
        const parts = viewBoxAttr.split(/\s+/).map(Number);
        if (parts.length === 4 && parts[2] > 0 && parts[3] > 0) {
          aspectRatio = parts[2] / parts[3];
          if (!exportManualChange) {
            setExportDefaults(parts[2], parts[3]);
          }
        }
      }

      svgInner.replaceChildren(svgEl);
      applyViewport();
      clearSelection();
      attachEditing(svgEl);
      syncGlow(Number(glowRange.value));
      captureCurrentSVG();
      downloadBtn.disabled = false;
      transparentPicker.disabled = false;
      makeTransparentBtn.disabled = false;
      updateEditControls();
      setStatus('SVG klar. Du kan nu finjustere og downloade uden at køre konvertering igen.');
    }

    function normalizeHex(value) {
      const hex = toHex(value);
      return hex ? hex.toLowerCase() : null;
    }

    function deleteSelected() {
      if (selectedElements.length === 0) return;
      selectedElements.forEach((el) => el.remove());
      captureCurrentSVG();
      clearSelection();
      setStatus('Slettede markerede elementer.');
    }

    function rotateSelected(delta) {
      selectedElements.forEach((el) => {
        const state = getTransformState(el);
        const rot = state.rot + delta;
        setTransformState(el, { ...state, rot });
      });
      captureCurrentSVG();
      setStatus('Rotér anvendt.');
    }

    function flipSelected(axis) {
      selectedElements.forEach((el) => {
        const state = getTransformState(el);
        const sx = axis === 'x' ? state.sx * -1 : state.sx;
        const sy = axis === 'y' ? state.sy * -1 : state.sy;
        setTransformState(el, { ...state, sx, sy });
      });
      captureCurrentSVG();
      setStatus('Spejlvending anvendt.');
    }

    function alignSelected(mode) {
      if (selectedElements.length < 2) return;
      const [anchor, ...rest] = selectedElements;
      const anchorBox = anchor.getBBox();
      rest.forEach((el) => {
        const box = el.getBBox();
        const state = getTransformState(el);
        let tx = state.tx;
        let ty = state.ty;

        switch (mode) {
          case 'left':
            tx += anchorBox.x - box.x;
            break;
          case 'center':
            tx += anchorBox.x + anchorBox.width / 2 - (box.x + box.width / 2);
            break;
          case 'right':
            tx += anchorBox.x + anchorBox.width - (box.x + box.width);
            break;
          case 'top':
            ty += anchorBox.y - box.y;
            break;
          case 'middle':
            ty += anchorBox.y + anchorBox.height / 2 - (box.y + box.height / 2);
            break;
          case 'bottom':
            ty += anchorBox.y + anchorBox.height - (box.y + box.height);
            break;
          default:
            break;
        }

        setTransformState(el, { ...state, tx, ty });
      });
      captureCurrentSVG();
      setStatus('Align anvendt i forhold til første markerede element.');
    }

    function makeColorTransparent(hexColor) {
      const target = normalizeHex(hexColor);
      if (!target) {
        setStatus('Angiv en gyldig farve før du gør den transparent.', true);
        return;
      }

      const svgEl = svgOutput.querySelector('svg');
      if (!svgEl) {
        setStatus('Ingen SVG at redigere endnu.', true);
        return;
      }

      const nodes = svgEl.querySelectorAll('path, rect, circle, ellipse, polygon, polyline, g');
      let changed = 0;
      nodes.forEach((node) => {
        if (!(node instanceof SVGElement)) return;
        const fill = node.getAttribute('fill') || '';
        const normalized = normalizeHex(fill);
        if (normalized && normalized === target) {
          if (!node.hasAttribute('data-original-fill')) {
            node.setAttribute('data-original-fill', fill);
          }
          node.setAttribute('fill', 'none');
          changed += 1;
        }
      });

      if (changed > 0) {
        captureCurrentSVG();
        setStatus(`Gjorde ${changed} element(er) transparente for ${target}.`);
      } else {
        setStatus('Ingen elementer med den valgte farve blev fundet.', true);
      }
    }

    function removeBackgroundByColor(hexColor) {
      const target = normalizeHex(hexColor);
      if (!target) {
        setStatus('Angiv en gyldig baggrundsfarve før du fjerner den.', true);
        return;
      }

      const svgEl = svgOutput.querySelector('svg');
      if (!svgEl) {
        setStatus('Ingen SVG at redigere endnu.', true);
        return;
      }

      const nodes = svgEl.querySelectorAll('path, rect, circle, ellipse, polygon, polyline, g');
      let changed = 0;
      nodes.forEach((node) => {
        if (!(node instanceof SVGElement)) return;
        const fill = node.getAttribute('fill') || '';
        const stroke = node.getAttribute('stroke') || '';
        const normalizedFill = normalizeHex(fill);
        const normalizedStroke = normalizeHex(stroke);
        let nodeChanged = false;
        if (normalizedFill && normalizedFill === target) {
          node.setAttribute('fill', 'none');
          nodeChanged = true;
        }
        if (normalizedStroke && normalizedStroke === target) {
          node.setAttribute('stroke', 'none');
          nodeChanged = true;
        }
        if (nodeChanged) changed += 1;
      });

      if (changed > 0) {
        captureCurrentSVG();
        setStatus(`Fjernede baggrundsfarven ${target} fra ${changed} element(er).`);
      } else {
        setStatus('Ingen elementer med den valgte baggrundsfarve blev fundet.', true);
      }
    }

    function ensureDefs(svgEl) {
      let defs = svgEl.querySelector('defs');
      if (!defs) {
        defs = document.createElementNS(SVG_NS, 'defs');
        svgEl.insertBefore(defs, svgEl.firstChild);
      }
      return defs;
    }

    function applyGlowToSVG() {
      const svgEl = svgOutput.querySelector('svg');
      if (!svgEl) return;

      const amount = Math.max(0, Math.min(50, Math.round(Number(glowRange.value))));
      const color = glowColor.value || '#00ffff';
      const mode = glowMode.value || 'glow';
      const includeGlow = mode === 'glow' || mode === 'both';
      const includeOutline = mode === 'outline' || mode === 'both';

      glowRange.value = String(amount);
      glowNumber.value = String(amount);
      glowValue.textContent = `${amount} px`;

      if (amount === 0 || (!includeGlow && !includeOutline)) {
        svgEl.style.filter = '';
        svgEl.removeAttribute('filter');
        captureCurrentSVG();
        return;
      }

      const defs = ensureDefs(svgEl);
      let filter = svgEl.querySelector(`#${GLOW_FILTER_ID}`);
      if (!filter) {
        filter = document.createElementNS(SVG_NS, 'filter');
        filter.id = GLOW_FILTER_ID;
        filter.setAttribute('x', '-50%');
        filter.setAttribute('y', '-50%');
        filter.setAttribute('width', '200%');
        filter.setAttribute('height', '200%');
        filter.setAttribute('color-interpolation-filters', 'sRGB');

        const blur = document.createElementNS(SVG_NS, 'feGaussianBlur');
        blur.id = 'glow-blur';
        blur.setAttribute('in', 'SourceAlpha');
        blur.setAttribute('result', 'blur');
        filter.appendChild(blur);

        const flood = document.createElementNS(SVG_NS, 'feFlood');
        flood.id = 'glow-flood';
        flood.setAttribute('result', 'flood');
        filter.appendChild(flood);

        const composite = document.createElementNS(SVG_NS, 'feComposite');
        composite.id = 'glow-composite';
        composite.setAttribute('in', 'flood');
        composite.setAttribute('in2', 'blur');
        composite.setAttribute('operator', 'in');
        composite.setAttribute('result', 'glow');
        filter.appendChild(composite);

        const outlineMorph = document.createElementNS(SVG_NS, 'feMorphology');
        outlineMorph.id = 'outline-morph';
        outlineMorph.setAttribute('in', 'SourceAlpha');
        outlineMorph.setAttribute('operator', 'dilate');
        outlineMorph.setAttribute('radius', '1');
        outlineMorph.setAttribute('result', 'outlineBase');
        filter.appendChild(outlineMorph);

        const outlineFlood = document.createElementNS(SVG_NS, 'feFlood');
        outlineFlood.id = 'outline-flood';
        outlineFlood.setAttribute('result', 'outlineFlood');
        filter.appendChild(outlineFlood);

        const outlineComposite = document.createElementNS(SVG_NS, 'feComposite');
        outlineComposite.id = 'outline-composite';
        outlineComposite.setAttribute('in', 'outlineFlood');
        outlineComposite.setAttribute('in2', 'outlineBase');
        outlineComposite.setAttribute('operator', 'in');
        outlineComposite.setAttribute('result', 'outline');
        filter.appendChild(outlineComposite);

        const merge = document.createElementNS(SVG_NS, 'feMerge');
        const mergeOutline = document.createElementNS(SVG_NS, 'feMergeNode');
        mergeOutline.id = 'merge-outline-node';
        mergeOutline.setAttribute('in', 'outline');
        merge.appendChild(mergeOutline);
        const mergeGlow = document.createElementNS(SVG_NS, 'feMergeNode');
        mergeGlow.id = 'merge-glow-node';
        mergeGlow.setAttribute('in', 'glow');
        merge.appendChild(mergeGlow);
        const mergeSrc = document.createElementNS(SVG_NS, 'feMergeNode');
        mergeSrc.setAttribute('in', 'SourceGraphic');
        merge.appendChild(mergeSrc);
        filter.appendChild(merge);

        defs.appendChild(filter);
      }

      const blurNode = filter.querySelector('#glow-blur');
      const floodNode = filter.querySelector('#glow-flood');
      const morphNode = filter.querySelector('#outline-morph');
      const outlineFlood = filter.querySelector('#outline-flood');
      if (blurNode) {
        blurNode.setAttribute('stdDeviation', includeGlow ? String(Math.max(0.1, amount / 2)) : '0');
      }
      if (floodNode) {
        floodNode.setAttribute('flood-color', color);
        floodNode.setAttribute('flood-opacity', includeGlow ? '1' : '0');
      }
      if (morphNode) {
        morphNode.setAttribute('radius', includeOutline ? String(Math.max(0.1, amount / 3)) : '0');
      }
      if (outlineFlood) {
        outlineFlood.setAttribute('flood-color', color);
        outlineFlood.setAttribute('flood-opacity', includeOutline ? '1' : '0');
      }

      svgEl.style.filter = `url(#${GLOW_FILTER_ID})`;
      captureCurrentSVG();
    }

    deleteBtn.addEventListener('click', deleteSelected);
    rotateLeftBtn.addEventListener('click', () => rotateSelected(-15));
    rotateRightBtn.addEventListener('click', () => rotateSelected(15));
    flipHBtn.addEventListener('click', () => flipSelected('x'));
    flipVBtn.addEventListener('click', () => flipSelected('y'));
    alignLeftBtn.addEventListener('click', () => alignSelected('left'));
    alignCenterBtn.addEventListener('click', () => alignSelected('center'));
    alignRightBtn.addEventListener('click', () => alignSelected('right'));
    alignTopBtn.addEventListener('click', () => alignSelected('top'));
    alignMiddleBtn.addEventListener('click', () => alignSelected('middle'));
    alignBottomBtn.addEventListener('click', () => alignSelected('bottom'));

    async function convertToSVG() {
      const imageData = await ensureImageData();
      if (!imageData) return;
      if (!(await ensureTracer())) return;

      clearSelection();
      downloadBtn.disabled = true;
      const options = mapOptions();
      setStatus('Sporer konturer … dette kan tage lidt tid for detaljerede billeder.');

      try {
        const svgString = ImageTracer.imagedataToSVG(imageData, options);
        if (!svgString || typeof svgString !== 'string') {
          throw new Error('Tomt SVG-resultat');
        }
        renderSVG(svgString);
      } catch (error) {
        console.error(error);
        const message = error instanceof Error ? error.message : 'ukendt fejl';
        setStatus(`Vektorisering mislykkedes (${message}). Prøv med lavere detaljeringsgrad eller mindre billede.`, true);
      }
    }

    convertBtn.addEventListener('click', convertToSVG);

    downloadBtn.addEventListener('click', () => {
      if (!lastSVG) return;
      const width = clampDimension(exportWidth.value, originalDimensions.width || 1024);
      let height = clampDimension(exportHeight.value, originalDimensions.height || 1024);
      if (lockAspect.checked && aspectRatio > 0) {
        height = Math.max(1, Math.round(width / aspectRatio));
        exportHeight.value = String(height);
      }

      const parsed = new DOMParser().parseFromString(lastSVG, 'image/svg+xml');
      const svgEl = parsed.querySelector('svg');
      if (!svgEl) return;
      if (!svgEl.getAttribute('viewBox')) {
        svgEl.setAttribute('viewBox', `0 0 ${width} ${height}`);
      }
      svgEl.setAttribute('width', `${width}px`);
      svgEl.setAttribute('height', `${height}px`);

      const serialized = new XMLSerializer().serializeToString(svgEl);
      const blob = new Blob([serialized], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const safeName = currentFileBase ? `${currentFileBase.replace(/\.svg$/i, '')}.svg` : 'vectorized.svg';
      a.href = url;
      a.download = safeName;
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
